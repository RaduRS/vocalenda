
Message string: {"type":"ConversationText","role":"user","content":"Actually, can you move it to twelve third to two two? Yeah. Two PM. On Wednesday."}
[2025-09-15T09:38:36.785Z] 📨 JSON MESSAGE FROM DEEPGRAM: {"type":"ConversationText","role":"user","content":"Actually, can you move it to twelve third to two two? Yeah. Two PM. On Wednesday."}
[2025-09-15T09:38:36.785Z] === PARSED DEEPGRAM JSON ===
{
  "type": "ConversationText",
  "role": "user",
  "content": "Actually, can you move it to twelve third to two two? Yeah. Two PM. On Wednesday."
}
[2025-09-15T09:38:36.785Z] === END PARSED JSON ===
[2025-09-15T09:38:36.785Z] 🎯 DEEPGRAM EVENT TYPE: ConversationText
[2025-09-15T09:38:36.785Z] 💭 CONVERSATION_TEXT: Actually, can you move it to twelve third to two two? Yeah. Two PM. On Wednesday.
[2025-09-15T09:38:36.785Z] 🔍 ConversationText role: 'user' -> Speaker: 'User'
📝 TRANSCRIPT: Added User: Actually, can you move it to twelve third to two two? Yeah. Two PM. On Wednesday.
📨 Received Deepgram JSON message: {"type":"History","role":"user","content":"Actually, can you move it to twelve third to two two? Yeah. Two PM. On Wednesday."}...
Message string: {"type":"History","role":"user","content":"Actually, can you move it to twelve third to two two? Yeah. Two PM. On Wednesday."}
[2025-09-15T09:38:36.788Z] 📨 JSON MESSAGE FROM DEEPGRAM: {"type":"History","role":"user","content":"Actually, can you move it to twelve third to two two? Yeah. Two PM. On Wednesday."}
[2025-09-15T09:38:36.788Z] === PARSED DEEPGRAM JSON ===
{
  "type": "History",
  "role": "user",
  "content": "Actually, can you move it to twelve third to two two? Yeah. Two PM. On Wednesday."
}
[2025-09-15T09:38:36.788Z] === END PARSED JSON ===
[2025-09-15T09:38:36.788Z] 🎯 DEEPGRAM EVENT TYPE: History
[2025-09-15T09:38:36.788Z] 📜 HISTORY: Message logged
[2025-09-15T09:38:36.788Z] 🔍 History role: 'user' -> Speaker: 'User'
📝 TRANSCRIPT: Skipping duplicate User: Actually, can you move it to twelve third to two two? Yeah. Two PM. On Wednesday.
[2025-09-15T09:38:36.788Z] 📝 Added transcript: [User] Actually, can you move it to twelve third to two two? Yeah. Two PM. On Wednesday.
[2025-09-15T09:38:37.631Z] 💓 KEEPALIVE: Sent to Deepgram
📨 Received Deepgram JSON message: {"type":"ConversationText","role":"assistant","content":"I want to confirm your requested new time."}...
Message string: {"type":"ConversationText","role":"assistant","content":"I want to confirm your requested new time."}
[2025-09-15T09:38:37.859Z] 📨 JSON MESSAGE FROM DEEPGRAM: {"type":"ConversationText","role":"assistant","content":"I want to confirm your requested new time."}
[2025-09-15T09:38:37.859Z] === PARSED DEEPGRAM JSON ===
{
  "type": "ConversationText",
  "role": "assistant",
  "content": "I want to confirm your requested new time."
}
[2025-09-15T09:38:37.859Z] === END PARSED JSON ===
[2025-09-15T09:38:37.859Z] 🎯 DEEPGRAM EVENT TYPE: ConversationText
[2025-09-15T09:38:37.859Z] 💭 CONVERSATION_TEXT: I want to confirm your requested new time.
[2025-09-15T09:38:37.859Z] 🔍 ConversationText role: 'assistant' -> Speaker: 'AI'
📝 TRANSCRIPT: Added AI: I want to confirm your requested new time.
📨 Received Deepgram JSON message: {"type":"History","role":"assistant","content":"I want to confirm your requested new time."}...
Message string: {"type":"History","role":"assistant","content":"I want to confirm your requested new time."}
[2025-09-15T09:38:37.860Z] 📨 JSON MESSAGE FROM DEEPGRAM: {"type":"History","role":"assistant","content":"I want to confirm your requested new time."}
[2025-09-15T09:38:37.860Z] === PARSED DEEPGRAM JSON ===
{
  "type": "History",
  "role": "assistant",
  "content": "I want to confirm your requested new time."
}
[2025-09-15T09:38:37.860Z] === END PARSED JSON ===
[2025-09-15T09:38:37.860Z] 🎯 DEEPGRAM EVENT TYPE: History
[2025-09-15T09:38:37.860Z] 📜 HISTORY: Message logged
[2025-09-15T09:38:37.860Z] 🔍 History role: 'assistant' -> Speaker: 'AI'
📝 TRANSCRIPT: Skipping duplicate AI: I want to confirm your requested new time.
[2025-09-15T09:38:37.860Z] 📝 Added transcript: [AI] I want to confirm your requested new time.
[2025-09-15T09:38:37.860Z] 🎵 Starting audio stream - feeding buffer
[2025-09-15T09:38:38.915Z] 🔇 Audio stream ended (timeout)
📨 Received Deepgram JSON message: {"type":"ConversationText","role":"assistant","content":"Did you mean 12:32 PM or 2:00 PM on Wednesday?"}...
Message string: {"type":"ConversationText","role":"assistant","content":"Did you mean 12:32 PM or 2:00 PM on Wednesday?"}
[2025-09-15T09:38:40.742Z] 📨 JSON MESSAGE FROM DEEPGRAM: {"type":"ConversationText","role":"assistant","content":"Did you mean 12:32 PM or 2:00 PM on Wednesday?"}
[2025-09-15T09:38:40.742Z] === PARSED DEEPGRAM JSON ===
{
  "type": "ConversationText",
  "role": "assistant",
  "content": "Did you mean 12:32 PM or 2:00 PM on Wednesday?"
}
[2025-09-15T09:38:40.742Z] === END PARSED JSON ===
[2025-09-15T09:38:40.742Z] 🎯 DEEPGRAM EVENT TYPE: ConversationText
[2025-09-15T09:38:40.742Z] 💭 CONVERSATION_TEXT: Did you mean 12:32 PM or 2:00 PM on Wednesday?
[2025-09-15T09:38:40.742Z] 🔍 ConversationText role: 'assistant' -> Speaker: 'AI'
📝 TRANSCRIPT: Added AI: Did you mean 12:32 PM or 2:00 PM on Wednesday?
📨 Received Deepgram JSON message: {"type":"History","role":"assistant","content":"Did you mean 12:32 PM or 2:00 PM on Wednesday?"}...
Message string: {"type":"History","role":"assistant","content":"Did you mean 12:32 PM or 2:00 PM on Wednesday?"}
[2025-09-15T09:38:40.742Z] 📨 JSON MESSAGE FROM DEEPGRAM: {"type":"History","role":"assistant","content":"Did you mean 12:32 PM or 2:00 PM on Wednesday?"}
[2025-09-15T09:38:40.742Z] === PARSED DEEPGRAM JSON ===
{
  "type": "History",
  "role": "assistant",
  "content": "Did you mean 12:32 PM or 2:00 PM on Wednesday?"
}
[2025-09-15T09:38:40.742Z] === END PARSED JSON ===
[2025-09-15T09:38:40.742Z] 🎯 DEEPGRAM EVENT TYPE: History
[2025-09-15T09:38:40.742Z] 📜 HISTORY: Message logged
[2025-09-15T09:38:40.742Z] 🔍 History role: 'assistant' -> Speaker: 'AI'
📝 TRANSCRIPT: Skipping duplicate AI: Did you mean 12:32 PM or 2:00 PM on Wednesday?
[2025-09-15T09:38:40.742Z] 📝 Added transcript: [AI] Did you mean 12:32 PM or 2:00 PM on Wednesday?
[2025-09-15T09:38:40.743Z] 🎵 Starting audio stream - feeding buffer
[2025-09-15T09:38:40.891Z] 🔇 Audio stream ended (timeout)
[2025-09-15T09:38:41.631Z] 💓 KEEPALIVE: Sent to Deepgram
📨 Received Deepgram JSON message: {"type":"ConversationText","role":"assistant","content":"Could you please clarify?"}...
Message string: {"type":"ConversationText","role":"assistant","content":"Could you please clarify?"}
[2025-09-15T09:38:44.664Z] 📨 JSON MESSAGE FROM DEEPGRAM: {"type":"ConversationText","role":"assistant","content":"Could you please clarify?"}
[2025-09-15T09:38:44.664Z] === PARSED DEEPGRAM JSON ===
{
  "type": "ConversationText",
  "role": "assistant",
  "content": "Could you please clarify?"
}
[2025-09-15T09:38:44.664Z] === END PARSED JSON ===
[2025-09-15T09:38:44.664Z] 🎯 DEEPGRAM EVENT TYPE: ConversationText
[2025-09-15T09:38:44.664Z] 💭 CONVERSATION_TEXT: Could you please clarify?
[2025-09-15T09:38:44.664Z] 🔍 ConversationText role: 'assistant' -> Speaker: 'AI'
📝 TRANSCRIPT: Added AI: Could you please clarify?
📨 Received Deepgram JSON message: {"type":"History","role":"assistant","content":"Could you please clarify?"}...
Message string: {"type":"History","role":"assistant","content":"Could you please clarify?"}
[2025-09-15T09:38:44.664Z] 📨 JSON MESSAGE FROM DEEPGRAM: {"type":"History","role":"assistant","content":"Could you please clarify?"}
[2025-09-15T09:38:44.664Z] === PARSED DEEPGRAM JSON ===
{
  "type": "History",
  "role": "assistant",
  "content": "Could you please clarify?"
}
[2025-09-15T09:38:44.664Z] === END PARSED JSON ===
[2025-09-15T09:38:44.664Z] 🎯 DEEPGRAM EVENT TYPE: History
[2025-09-15T09:38:44.664Z] 📜 HISTORY: Message logged
[2025-09-15T09:38:44.664Z] 🔍 History role: 'assistant' -> Speaker: 'AI'
📝 TRANSCRIPT: Skipping duplicate AI: Could you please clarify?
[2025-09-15T09:38:44.664Z] 📝 Added transcript: [AI] Could you please clarify?
[2025-09-15T09:38:44.664Z] 🎵 Starting audio stream - feeding buffer
📨 Received Deepgram JSON message: {"type":"AgentAudioDone"}...
Message string: {"type":"AgentAudioDone"}
[2025-09-15T09:38:44.665Z] 📨 JSON MESSAGE FROM DEEPGRAM: {"type":"AgentAudioDone"}
[2025-09-15T09:38:44.665Z] === PARSED DEEPGRAM JSON ===
{
  "type": "AgentAudioDone"
}
[2025-09-15T09:38:44.665Z] === END PARSED JSON ===
[2025-09-15T09:38:44.665Z] 🎯 DEEPGRAM EVENT TYPE: AgentAudioDone
[2025-09-15T09:38:44.665Z] 🔇 AGENT_AUDIO_DONE: AI finished sending audio
[2025-09-15T09:38:44.665Z] 🔇 SILENCE: Started tracking
[2025-09-15T09:38:44.665Z] ✅ Agent speech ended. Pacer will now send silence until next utterance.
[2025-09-15T09:38:45.631Z] 💓 KEEPALIVE: Sent to Deepgram
[2025-09-15T09:38:44.665Z] 🔇 SILENCE_CHECK: 999ms of silence
📨 Received Deepgram JSON message: {"type":"UserStartedSpeaking"}...
Message string: {"type":"UserStartedSpeaking"}
[2025-09-15T09:38:46.176Z] 📨 JSON MESSAGE FROM DEEPGRAM: {"type":"UserStartedSpeaking"}
[2025-09-15T09:38:46.176Z] === PARSED DEEPGRAM JSON ===
{
  "type": "UserStartedSpeaking"
}
[2025-09-15T09:38:46.176Z] === END PARSED JSON ===
[2025-09-15T09:38:46.176Z] 🎯 DEEPGRAM EVENT TYPE: UserStartedSpeaking
[2025-09-15T09:38:46.176Z] 🎤 USER_STARTED_SPEAKING: User began speaking
[2025-09-15T09:38:46.176Z] 🔄 BARGE_IN: Cleared Twilio audio queue for user speech
[2025-09-15T09:38:46.176Z] 🔄 SILENCE_RESET: User speaking, silence tracking reset
📨 Received Deepgram JSON message: {"type":"ConversationText","role":"user","content":"Two."}...
Message string: {"type":"ConversationText","role":"user","content":"Two."}
[2025-09-15T09:38:46.197Z] 📨 JSON MESSAGE FROM DEEPGRAM: {"type":"ConversationText","role":"user","content":"Two."}
[2025-09-15T09:38:46.197Z] === PARSED DEEPGRAM JSON ===
{
  "type": "ConversationText",
  "role": "user",
  "content": "Two."
}
[2025-09-15T09:38:46.197Z] === END PARSED JSON ===
[2025-09-15T09:38:46.197Z] 🎯 DEEPGRAM EVENT TYPE: ConversationText
[2025-09-15T09:38:46.197Z] 💭 CONVERSATION_TEXT: Two.
[2025-09-15T09:38:46.197Z] 🔍 ConversationText role: 'user' -> Speaker: 'User'
📝 TRANSCRIPT: Added User: Two.
📨 Received Deepgram JSON message: {"type":"History","role":"user","content":"Two."}...
Message string: {"type":"History","role":"user","content":"Two."}
[2025-09-15T09:38:46.207Z] 📨 JSON MESSAGE FROM DEEPGRAM: {"type":"History","role":"user","content":"Two."}
[2025-09-15T09:38:46.207Z] === PARSED DEEPGRAM JSON ===
{
  "type": "History",
  "role": "user",
  "content": "Two."
}
[2025-09-15T09:38:46.207Z] === END PARSED JSON ===
[2025-09-15T09:38:46.207Z] 🎯 DEEPGRAM EVENT TYPE: History
[2025-09-15T09:38:46.207Z] 📜 HISTORY: Message logged
[2025-09-15T09:38:46.207Z] 🔍 History role: 'user' -> Speaker: 'User'
📝 TRANSCRIPT: Skipping duplicate User: Two.
[2025-09-15T09:38:46.207Z] 📝 Added transcript: [User] Two.
📨 Received Deepgram JSON message: {"type":"FunctionCallRequest","functions":[{"id":"call_Wj9Me25rST6LVy3WUAlRdZO8","name":"update_booking","arguments":"{\"new_time\":\"14:00\"}","client_side":true}]}...
Message string: {"type":"FunctionCallRequest","functions":[{"id":"call_Wj9Me25rST6LVy3WUAlRdZO8","name":"update_booking","arguments":"{\"new_time\":\"14:00\"}","client_side":true}]}
[2025-09-15T09:38:46.984Z] 📨 JSON MESSAGE FROM DEEPGRAM: {"type":"FunctionCallRequest","functions":[{"id":"call_Wj9Me25rST6LVy3WUAlRdZO8","name":"update_booking","arguments":"{\"new_time\":\"14:00\"}","client_side":true}]}
[2025-09-15T09:38:46.984Z] === PARSED DEEPGRAM JSON ===
{
  "type": "FunctionCallRequest",
  "functions": [
    {
      "id": "call_Wj9Me25rST6LVy3WUAlRdZO8",
      "name": "update_booking",
      "arguments": "{\"new_time\":\"14:00\"}",
      "client_side": true
    }
  ]
}
[2025-09-15T09:38:46.984Z] === END PARSED JSON ===
[2025-09-15T09:38:46.984Z] 🎯 DEEPGRAM EVENT TYPE: FunctionCallRequest
[2025-09-15T09:38:46.984Z] 🚨🚨 FUNCTION_CALL_REQUEST DETECTED! 🚨🚨
[2025-09-15T09:38:46.984Z] ✅ SUCCESS: AI requesting function calls!
[2025-09-15T09:38:46.984Z] 📋 Functions: [
  {
    "id": "call_Wj9Me25rST6LVy3WUAlRdZO8",
    "name": "update_booking",
    "arguments": "{\"new_time\":\"14:00\"}",
    "client_side": true
  }
]
[2025-09-15T09:38:46.984Z] ⏸️ SILENCE: Pausing timer - Processing function calls
[2025-09-15T09:38:46.985Z] ⏸️ KEEPALIVE: Paused for function processing
[2025-09-15T09:38:46.984Z] 🔧 Processing function: update_booking
[2025-09-15T09:38:46.984Z] 🔧 CALLING: handleFunctionCall for update_booking...
📝 Session updated for call CA20b2d8268ce7b7a3ef3351f331ad95a0: {
  callerPhone: '+447468306825',
  customerName: 'Marco',
  lastBookingDate: '2025-09-17',
  lastBookingTime: '12:45',
  lastServiceId: '63555ab0-f0ac-48c3-a2b2-766356aeb8f4',
  lastServiceName: 'beard trim',
  lastServiceDuration: 15,
  bookings: [
    {
      customerName: 'Marco',
      date: '2025-09-18',
      time: '12:30',
      serviceId: '63555ab0-f0ac-48c3-a2b2-766356aeb8f4',
      serviceName: 'beard trim',
      serviceDuration: 15,
      appointmentId: '7c6e3a32-ae3e-42c9-97db-89a86e0525c7',
      type: 'create'
    },
    {
      customerName: 'Marco',
      currentDate: '2025-09-18',
      currentTime: '12:30',
      newDate: '2025-09-17',
      newTime: '12:45',
      newServiceId: undefined,
      type: 'update',
      finalDate: '2025-09-17',
      finalTime: '12:45:00',
      appointmentId: 'ee2b24b5-eff8-463b-ac9e-bfcf8d803a5a',
      serviceName: 'beard trim'
    }
  ],
  lastAppointmentId: '7c6e3a32-ae3e-42c9-97db-89a86e0525c7'
}
[2025-09-15T09:38:46.985Z] 🚀 STARTING handleFunctionCall
[2025-09-15T09:38:46.985Z] 🔧 Function call received: {
  "function_name": "update_booking",
  "function_call_id": "call_Wj9Me25rST6LVy3WUAlRdZO8",
  "parameters": {
    "new_time": "14:00"
  }
}
[2025-09-15T09:38:46.985Z] 📋 Function name: update_booking
[2025-09-15T09:38:46.985Z] 📊 Parameters: {
  "new_time": "14:00"
}
[2025-09-15T09:38:46.985Z] 🏢 Business config exists: true
[2025-09-15T09:38:46.985Z] 🌐 WebSocket state: 1
🔧 Function call received: {
  "function_name": "update_booking",
  "function_call_id": "call_Wj9Me25rST6LVy3WUAlRdZO8",
  "parameters": {
    "new_time": "14:00"
  }
}
📝 updateBooking called with params: {
  "new_time": "14:00"
}
📋 Session data: {
  callerPhone: '+447468306825',
  customerName: 'Marco',
  lastBookingDate: '2025-09-17',
  lastBookingTime: '12:45',
  lastServiceId: '63555ab0-f0ac-48c3-a2b2-766356aeb8f4',
  lastServiceName: 'beard trim',
  lastServiceDuration: 15,
  bookings: [
    {
      customerName: 'Marco',
      date: '2025-09-18',
      time: '12:30',
      serviceId: '63555ab0-f0ac-48c3-a2b2-766356aeb8f4',
      serviceName: 'beard trim',
      serviceDuration: 15,
      appointmentId: '7c6e3a32-ae3e-42c9-97db-89a86e0525c7',
      type: 'create'
    },
    {
      customerName: 'Marco',
      currentDate: '2025-09-18',
      currentTime: '12:30',
      newDate: '2025-09-17',
      newTime: '12:45',
      newServiceId: undefined,
      type: 'update',
      finalDate: '2025-09-17',
      finalTime: '12:45:00',
      appointmentId: 'ee2b24b5-eff8-463b-ac9e-bfcf8d803a5a',
      serviceName: 'beard trim'
    }
  ],
  lastAppointmentId: '7c6e3a32-ae3e-42c9-97db-89a86e0525c7'
}
🔄 Using customer info: {
  customerName: 'Marco',
  currentDate: '2025-09-17',
  currentTime: '12:45'
}
📞 Caller phone: +447468306825
👤 Customer: Marco
📅 Booking: 2025-09-17 at 12:45
📝 Session updated for call CA20b2d8268ce7b7a3ef3351f331ad95a0: {
  callerPhone: '+447468306825',
  customerName: 'Marco',
  lastBookingDate: '2025-09-17',
  lastBookingTime: '14:00',
  lastServiceId: '63555ab0-f0ac-48c3-a2b2-766356aeb8f4',
  lastServiceName: 'beard trim',
  lastServiceDuration: 15,
  bookings: [
    {
      customerName: 'Marco',
      date: '2025-09-18',
      time: '12:30',
      serviceId: '63555ab0-f0ac-48c3-a2b2-766356aeb8f4',
      serviceName: 'beard trim',
      serviceDuration: 15,
      appointmentId: '7c6e3a32-ae3e-42c9-97db-89a86e0525c7',
      type: 'create'
    },
    {
      customerName: 'Marco',
      currentDate: '2025-09-18',
      currentTime: '12:30',
      newDate: '2025-09-17',
      newTime: '12:45',
      newServiceId: undefined,
      type: 'update',
      finalDate: '2025-09-17',
      finalTime: '12:45:00',
      appointmentId: 'ee2b24b5-eff8-463b-ac9e-bfcf8d803a5a',
      serviceName: 'beard trim'
    },
    {
      customerName: 'Marco',
      currentDate: '2025-09-17',
      currentTime: '12:45',
      newDate: undefined,
      newTime: '14:00',
      newServiceId: undefined,
      type: 'update'
    }
  ],
  lastAppointmentId: '7c6e3a32-ae3e-42c9-97db-89a86e0525c7'
}
📦 Update request body: {
  "business_id": "1bb3c552-053f-40c4-b3f2-bdb51af87b52",
  "customer_name": "Marco",
  "current_date": "2025-09-17",
  "current_time": "12:45",
  "caller_phone": "+447468306825",
  "new_time": "14:00"
}
📨 Received Deepgram JSON message: {"type":"UserStartedSpeaking"}...
Message string: {"type":"UserStartedSpeaking"}
[2025-09-15T09:38:46.995Z] 📨 JSON MESSAGE FROM DEEPGRAM: {"type":"UserStartedSpeaking"}
[2025-09-15T09:38:46.995Z] === PARSED DEEPGRAM JSON ===
{
  "type": "UserStartedSpeaking"
}
[2025-09-15T09:38:46.995Z] === END PARSED JSON ===
[2025-09-15T09:38:46.995Z] 🎯 DEEPGRAM EVENT TYPE: UserStartedSpeaking
[2025-09-15T09:38:46.995Z] 🎤 USER_STARTED_SPEAKING: User began speaking
[2025-09-15T09:38:46.995Z] 🔄 BARGE_IN: Cleared Twilio audio queue for user speech
[2025-09-15T09:38:46.995Z] 🔄 SILENCE_RESET: User speaking, silence tracking reset
📨 Received Deepgram JSON message: {"type":"ConversationText","role":"user","content":"Two PM on Wednesday. I want to move it"}...
Message string: {"type":"ConversationText","role":"user","content":"Two PM on Wednesday. I want to move it"}
[2025-09-15T09:38:48.844Z] 📨 JSON MESSAGE FROM DEEPGRAM: {"type":"ConversationText","role":"user","content":"Two PM on Wednesday. I want to move it"}
[2025-09-15T09:38:48.844Z] === PARSED DEEPGRAM JSON ===
{
  "type": "ConversationText",
  "role": "user",
  "content": "Two PM on Wednesday. I want to move it"
}
[2025-09-15T09:38:48.844Z] === END PARSED JSON ===
[2025-09-15T09:38:48.844Z] 🎯 DEEPGRAM EVENT TYPE: ConversationText
[2025-09-15T09:38:48.844Z] 💭 CONVERSATION_TEXT: Two PM on Wednesday. I want to move it
[2025-09-15T09:38:48.844Z] 🔍 ConversationText role: 'user' -> Speaker: 'User'
📝 TRANSCRIPT: Added User: Two PM on Wednesday. I want to move it
📨 Received Deepgram JSON message: {"type":"History","role":"user","content":"Two PM on Wednesday. I want to move it"}...
Message string: {"type":"History","role":"user","content":"Two PM on Wednesday. I want to move it"}
[2025-09-15T09:38:48.847Z] 📨 JSON MESSAGE FROM DEEPGRAM: {"type":"History","role":"user","content":"Two PM on Wednesday. I want to move it"}
[2025-09-15T09:38:48.847Z] === PARSED DEEPGRAM JSON ===
{
  "type": "History",
  "role": "user",
  "content": "Two PM on Wednesday. I want to move it"
}
[2025-09-15T09:38:48.847Z] === END PARSED JSON ===
[2025-09-15T09:38:48.847Z] 🎯 DEEPGRAM EVENT TYPE: History
[2025-09-15T09:38:48.847Z] 📜 HISTORY: Message logged
[2025-09-15T09:38:48.847Z] 🔍 History role: 'user' -> Speaker: 'User'
📝 TRANSCRIPT: Skipping duplicate User: Two PM on Wednesday. I want to move it
[2025-09-15T09:38:48.847Z] 📝 Added transcript: [User] Two PM on Wednesday. I want to move it
📨 Received Deepgram JSON message: {"type":"FunctionCallRequest","functions":[{"id":"call_Cdxo31IPNR56DQ7HH3s1wg8m","name":"update_booking","arguments":"{\"new_date\":\"2025-09-17\",\"new_time\":\"14:00\"}","client_side":true}]}...
Message string: {"type":"FunctionCallRequest","functions":[{"id":"call_Cdxo31IPNR56DQ7HH3s1wg8m","name":"update_booking","arguments":"{\"new_date\":\"2025-09-17\",\"new_time\":\"14:00\"}","client_side":true}]}
[2025-09-15T09:38:49.959Z] 📨 JSON MESSAGE FROM DEEPGRAM: {"type":"FunctionCallRequest","functions":[{"id":"call_Cdxo31IPNR56DQ7HH3s1wg8m","name":"update_booking","arguments":"{\"new_date\":\"2025-09-17\",\"new_time\":\"14:00\"}","client_side":true}]}
[2025-09-15T09:38:49.959Z] === PARSED DEEPGRAM JSON ===
{
  "type": "FunctionCallRequest",
  "functions": [
    {
      "id": "call_Cdxo31IPNR56DQ7HH3s1wg8m",
      "name": "update_booking",
      "arguments": "{\"new_date\":\"2025-09-17\",\"new_time\":\"14:00\"}",
      "client_side": true
    }
  ]
}
[2025-09-15T09:38:49.959Z] === END PARSED JSON ===
[2025-09-15T09:38:49.959Z] 🎯 DEEPGRAM EVENT TYPE: FunctionCallRequest
[2025-09-15T09:38:49.959Z] 🚨🚨 FUNCTION_CALL_REQUEST DETECTED! 🚨🚨
[2025-09-15T09:38:49.959Z] ✅ SUCCESS: AI requesting function calls!
[2025-09-15T09:38:49.959Z] 📋 Functions: [
  {
    "id": "call_Cdxo31IPNR56DQ7HH3s1wg8m",
    "name": "update_booking",
    "arguments": "{\"new_date\":\"2025-09-17\",\"new_time\":\"14:00\"}",
    "client_side": true
  }
]
[2025-09-15T09:38:49.959Z] ⏸️ SILENCE: Pausing timer - Processing function calls
[2025-09-15T09:38:49.959Z] ⏸️ KEEPALIVE: Paused for function processing
[2025-09-15T09:38:49.959Z] 🔧 Processing function: update_booking
[2025-09-15T09:38:49.959Z] 🔧 CALLING: handleFunctionCall for update_booking...
📝 Session updated for call CA20b2d8268ce7b7a3ef3351f331ad95a0: {
  callerPhone: '+447468306825',
  customerName: 'Marco',
  lastBookingDate: '2025-09-17',
  lastBookingTime: '14:00',
  lastServiceId: '63555ab0-f0ac-48c3-a2b2-766356aeb8f4',
  lastServiceName: 'beard trim',
  lastServiceDuration: 15,
  bookings: [
    {
      customerName: 'Marco',
      date: '2025-09-18',
      time: '12:30',
      serviceId: '63555ab0-f0ac-48c3-a2b2-766356aeb8f4',
      serviceName: 'beard trim',
      serviceDuration: 15,
      appointmentId: '7c6e3a32-ae3e-42c9-97db-89a86e0525c7',
      type: 'create'
    },
    {
      customerName: 'Marco',
      currentDate: '2025-09-18',
      currentTime: '12:30',
      newDate: '2025-09-17',
      newTime: '12:45',
      newServiceId: undefined,
      type: 'update',
      finalDate: '2025-09-17',
      finalTime: '12:45:00',
      appointmentId: 'ee2b24b5-eff8-463b-ac9e-bfcf8d803a5a',
      serviceName: 'beard trim'
    },
    {
      customerName: 'Marco',
      currentDate: '2025-09-17',
      currentTime: '12:45',
      newDate: undefined,
      newTime: '14:00',
      newServiceId: undefined,
      type: 'update'
    }
  ],
  lastAppointmentId: '7c6e3a32-ae3e-42c9-97db-89a86e0525c7'
}
[2025-09-15T09:38:49.959Z] 🚀 STARTING handleFunctionCall
[2025-09-15T09:38:49.959Z] 🔧 Function call received: {
  "function_name": "update_booking",
  "function_call_id": "call_Cdxo31IPNR56DQ7HH3s1wg8m",
  "parameters": {
    "new_date": "2025-09-17",
    "new_time": "14:00"
  }
}
[2025-09-15T09:38:49.959Z] 📋 Function name: update_booking
[2025-09-15T09:38:49.959Z] 📊 Parameters: {
  "new_date": "2025-09-17",
  "new_time": "14:00"
}
[2025-09-15T09:38:49.959Z] 🏢 Business config exists: true
[2025-09-15T09:38:49.959Z] 🌐 WebSocket state: 1
🔧 Function call received: {
  "function_name": "update_booking",
  "function_call_id": "call_Cdxo31IPNR56DQ7HH3s1wg8m",
  "parameters": {
    "new_date": "2025-09-17",
    "new_time": "14:00"
  }
}
📝 updateBooking called with params: {
  "new_date": "2025-09-17",
  "new_time": "14:00"
}
📋 Session data: {
  callerPhone: '+447468306825',
  customerName: 'Marco',
  lastBookingDate: '2025-09-17',
  lastBookingTime: '14:00',
  lastServiceId: '63555ab0-f0ac-48c3-a2b2-766356aeb8f4',
  lastServiceName: 'beard trim',
  lastServiceDuration: 15,
  bookings: [
    {
      customerName: 'Marco',
      date: '2025-09-18',
      time: '12:30',
      serviceId: '63555ab0-f0ac-48c3-a2b2-766356aeb8f4',
      serviceName: 'beard trim',
      serviceDuration: 15,
      appointmentId: '7c6e3a32-ae3e-42c9-97db-89a86e0525c7',
      type: 'create'
    },
    {
      customerName: 'Marco',
      currentDate: '2025-09-18',
      currentTime: '12:30',
      newDate: '2025-09-17',
      newTime: '12:45',
      newServiceId: undefined,
      type: 'update',
      finalDate: '2025-09-17',
      finalTime: '12:45:00',
      appointmentId: 'ee2b24b5-eff8-463b-ac9e-bfcf8d803a5a',
      serviceName: 'beard trim'
    },
    {
      customerName: 'Marco',
      currentDate: '2025-09-17',
      currentTime: '12:45',
      newDate: undefined,
      newTime: '14:00',
      newServiceId: undefined,
      type: 'update'
    }
  ],
  lastAppointmentId: '7c6e3a32-ae3e-42c9-97db-89a86e0525c7'
}
🔄 Using customer info: {
  customerName: 'Marco',
  currentDate: '2025-09-17',
  currentTime: '14:00'
}
📞 Caller phone: +447468306825
👤 Customer: Marco
📅 Booking: 2025-09-17 at 14:00
📝 Session updated for call CA20b2d8268ce7b7a3ef3351f331ad95a0: {
  callerPhone: '+447468306825',
  customerName: 'Marco',
  lastBookingDate: '2025-09-17',
  lastBookingTime: '14:00',
  lastServiceId: '63555ab0-f0ac-48c3-a2b2-766356aeb8f4',
  lastServiceName: 'beard trim',
  lastServiceDuration: 15,
  bookings: [
    {
      customerName: 'Marco',
      date: '2025-09-18',
      time: '12:30',
      serviceId: '63555ab0-f0ac-48c3-a2b2-766356aeb8f4',
      serviceName: 'beard trim',
      serviceDuration: 15,
      appointmentId: '7c6e3a32-ae3e-42c9-97db-89a86e0525c7',
      type: 'create'
    },
    {
      customerName: 'Marco',
      currentDate: '2025-09-18',
      currentTime: '12:30',
      newDate: '2025-09-17',
      newTime: '12:45',
      newServiceId: undefined,
      type: 'update',
      finalDate: '2025-09-17',
      finalTime: '12:45:00',
      appointmentId: 'ee2b24b5-eff8-463b-ac9e-bfcf8d803a5a',
      serviceName: 'beard trim'
    },
    {
      customerName: 'Marco',
      currentDate: '2025-09-17',
      currentTime: '12:45',
      newDate: undefined,
      newTime: '14:00',
      newServiceId: undefined,
      type: 'update'
    },
    {
      customerName: 'Marco',
      currentDate: '2025-09-17',
      currentTime: '14:00',
      newDate: '2025-09-17',
      newTime: '14:00',
      newServiceId: undefined,
      type: 'update'
    }
  ],
  lastAppointmentId: '7c6e3a32-ae3e-42c9-97db-89a86e0525c7'
}
📦 Update request body: {
  "business_id": "1bb3c552-053f-40c4-b3f2-bdb51af87b52",
  "customer_name": "Marco",
  "current_date": "2025-09-17",
  "current_time": "14:00",
  "caller_phone": "+447468306825",
  "new_date": "2025-09-17",
  "new_time": "14:00"
}
✅ Booking updated successfully: {
  success: true,
  message: 'Booking updated successfully',
  booking: {
    id: '9ddf3e55-6823-45ff-8e48-761e1478cf04',
    customer_name: 'Marco',
    service_name: 'beard trim',
    date: '2025-09-17',
    start_time: '14:00:00',
    end_time: '13:15:00',
    status: 'confirmed'
  }
}
📝 Session updated for call CA20b2d8268ce7b7a3ef3351f331ad95a0: {
  callerPhone: '+447468306825',
  customerName: 'Marco',
  lastBookingDate: '2025-09-17',
  lastBookingTime: '14:00',
  lastServiceId: '63555ab0-f0ac-48c3-a2b2-766356aeb8f4',
  lastServiceName: 'beard trim',
  lastServiceDuration: 15,
  bookings: [
    {
      customerName: 'Marco',
      date: '2025-09-18',
      time: '12:30',
      serviceId: '63555ab0-f0ac-48c3-a2b2-766356aeb8f4',
      serviceName: 'beard trim',
      serviceDuration: 15,
      appointmentId: '7c6e3a32-ae3e-42c9-97db-89a86e0525c7',
      type: 'create'
    },
    {
      customerName: 'Marco',
      currentDate: '2025-09-18',
      currentTime: '12:30',
      newDate: '2025-09-17',
      newTime: '12:45',
      newServiceId: undefined,
      type: 'update',
      finalDate: '2025-09-17',
      finalTime: '12:45:00',
      appointmentId: 'ee2b24b5-eff8-463b-ac9e-bfcf8d803a5a',
      serviceName: 'beard trim'
    },
    {
      customerName: 'Marco',
      currentDate: '2025-09-17',
      currentTime: '12:45',
      newDate: undefined,
      newTime: '14:00',
      newServiceId: undefined,
      type: 'update'
    },
    {
      customerName: 'Marco',
      currentDate: '2025-09-17',
      currentTime: '14:00',
      newDate: '2025-09-17',
      newTime: '14:00',
      newServiceId: undefined,
      type: 'update',
      finalDate: '2025-09-17',
      finalTime: '14:00:00',
      appointmentId: '9ddf3e55-6823-45ff-8e48-761e1478cf04',
      serviceName: 'beard trim'
    }
  ],
  lastAppointmentId: '7c6e3a32-ae3e-42c9-97db-89a86e0525c7'
}
✅ Sending update_booking response to Deepgram
✅ Function response sent successfully to Deepgram
🔄 Waiting for Deepgram to process the response...
[2025-09-15T09:38:46.984Z] ✅ COMPLETED: handleFunctionCall for update_booking
[2025-09-15T09:38:50.986Z] ▶️ KEEPALIVE: Resumed after function processing
[2025-09-15T09:38:46.984Z] ▶️ SILENCE: Resuming timer - Function processing completed
✅ Booking updated successfully: {
  success: true,
  message: 'Booking updated successfully',
  booking: {
    id: 'adaf6700-7750-45e7-86cb-9e42707b4654',
    customer_name: 'Marco',
    service_name: 'haircut',
    date: '2025-09-17',
    start_time: '14:00:00',
    end_time: '13:30:00',
    status: 'confirmed'
  }
}
📝 Session updated for call CA20b2d8268ce7b7a3ef3351f331ad95a0: {
  callerPhone: '+447468306825',
  customerName: 'Marco',
  lastBookingDate: '2025-09-17',
  lastBookingTime: '14:00',
  lastServiceId: '63555ab0-f0ac-48c3-a2b2-766356aeb8f4',
  lastServiceName: 'beard trim',
  lastServiceDuration: 15,
  bookings: [
    {
      customerName: 'Marco',
      date: '2025-09-18',
      time: '12:30',
      serviceId: '63555ab0-f0ac-48c3-a2b2-766356aeb8f4',
      serviceName: 'beard trim',
      serviceDuration: 15,
      appointmentId: '7c6e3a32-ae3e-42c9-97db-89a86e0525c7',
      type: 'create'
    },
    {
      customerName: 'Marco',
      currentDate: '2025-09-18',
      currentTime: '12:30',
      newDate: '2025-09-17',
      newTime: '12:45',
      newServiceId: undefined,
      type: 'update',
      finalDate: '2025-09-17',
      finalTime: '12:45:00',
      appointmentId: 'ee2b24b5-eff8-463b-ac9e-bfcf8d803a5a',
      serviceName: 'beard trim'
    },
    {
      customerName: 'Marco',
      currentDate: '2025-09-17',
      currentTime: '12:45',
      newDate: undefined,
      newTime: '14:00',
      newServiceId: undefined,
      type: 'update'
    },
    {
      customerName: 'Marco',
      currentDate: '2025-09-17',
      currentTime: '14:00',
      newDate: '2025-09-17',
      newTime: '14:00',
      newServiceId: undefined,
      type: 'update',
      finalDate: '2025-09-17',
      finalTime: '14:00:00',
      appointmentId: 'adaf6700-7750-45e7-86cb-9e42707b4654',
      serviceName: 'haircut'
    }
  ],
  lastAppointmentId: '7c6e3a32-ae3e-42c9-97db-89a86e0525c7'
}
✅ Sending update_booking response to Deepgram
✅ Function response sent successfully to Deepgram
🔄 Waiting for Deepgram to process the response...
📨 Received Deepgram JSON message: {"type":"History","function_calls":[{"id":"call_Cdxo31IPNR56DQ7HH3s1wg8m","name":"update_booking","client_side":true,"arguments":"{\"new_date\":\"2025-09-17\",\"new_time\":\"14:00\"}","response":"{\"s...
Message string: {"type":"History","function_calls":[{"id":"call_Cdxo31IPNR56DQ7HH3s1wg8m","name":"update_booking","client_side":true,"arguments":"{\"new_date\":\"2025-09-17\",\"new_time\":\"14:00\"}","response":"{\"success\":true,\"message\":\"Booking updated successfully for undefined\",\"booking\":{\"id\":\"adaf6700-7750-45e7-86cb-9e42707b4654\",\"customer_name\":\"Marco\",\"service_name\":\"haircut\",\"date\":\"2025-09-17\",\"start_time\":\"14:00:00\",\"end_time\":\"13:30:00\",\"status\":\"confirmed\"}}"}]}
[2025-09-15T09:38:52.640Z] 📨 JSON MESSAGE FROM DEEPGRAM: {"type":"History","function_calls":[{"id":"call_Cdxo31IPNR56DQ7HH3s1wg8m","name":"update_booking","client_side":true,"arguments":"{\"new_date\":\"2025-09-17\",\"new_time\":\"14:00\"}","response":"{\"success\":true,\"message\":\"Booking updated successfully for undefined\",\"booking\":{\"id\":\"adaf6700-7750-45e7-86cb-9e42707b4654\",\"customer_name\":\"Marco\",\"service_name\":\"haircut\",\"date\":\"2025-09-17\",\"start_time\":\"14:00:00\",\"end_time\":\"13:30:00\",\"status\":\"confirmed\"}}"}]}
[2025-09-15T09:38:52.640Z] === PARSED DEEPGRAM JSON ===
{
  "type": "History",
  "function_calls": [
    {
      "id": "call_Cdxo31IPNR56DQ7HH3s1wg8m",
      "name": "update_booking",
      "client_side": true,
      "arguments": "{\"new_date\":\"2025-09-17\",\"new_time\":\"14:00\"}",
      "response": "{\"success\":true,\"message\":\"Booking updated successfully for undefined\",\"booking\":{\"id\":\"adaf6700-7750-45e7-86cb-9e42707b4654\",\"customer_name\":\"Marco\",\"service_name\":\"haircut\",\"date\":\"2025-09-17\",\"start_time\":\"14:00:00\",\"end_time\":\"13:30:00\",\"status\":\"confirmed\"}}"
    }
  ]
}
[2025-09-15T09:38:52.640Z] === END PARSED JSON ===
[2025-09-15T09:38:52.640Z] 🎯 DEEPGRAM EVENT TYPE: History
[2025-09-15T09:38:52.640Z] 📜 HISTORY: Message logged
[2025-09-15T09:38:49.959Z] ✅ COMPLETED: handleFunctionCall for update_booking
[2025-09-15T09:38:53.492Z] ▶️ KEEPALIVE: Resumed after function processing
[2025-09-15T09:38:49.959Z] ▶️ SILENCE: Resuming timer - Function processing completed
[2025-09-15T09:38:53.631Z] 💓 KEEPALIVE: Sent to Deepgram
📨 Received Deepgram JSON message: {"type":"ConversationText","role":"assistant","content":"Your appointment has been moved to 2 PM on Wednesday, 17th September 2025."}...
Message string: {"type":"ConversationText","role":"assistant","content":"Your appointment has been moved to 2 PM on Wednesday, 17th September 2025."}
[2025-09-15T09:38:53.879Z] 📨 JSON MESSAGE FROM DEEPGRAM: {"type":"ConversationText","role":"assistant","content":"Your appointment has been moved to 2 PM on Wednesday, 17th September 2025."}
[2025-09-15T09:38:53.879Z] === PARSED DEEPGRAM JSON ===
{
  "type": "ConversationText",
  "role": "assistant",
  "content": "Your appointment has been moved to 2 PM on Wednesday, 17th September 2025."
}
[2025-09-15T09:38:53.879Z] === END PARSED JSON ===
[2025-09-15T09:38:53.879Z] 🎯 DEEPGRAM EVENT TYPE: ConversationText
[2025-09-15T09:38:53.879Z] 💭 CONVERSATION_TEXT: Your appointment has been moved to 2 PM on Wednesday, 17th September 2025.
[2025-09-15T09:38:53.879Z] 🔍 ConversationText role: 'assistant' -> Speaker: 'AI'
📝 TRANSCRIPT: Added AI: Your appointment has been moved to 2 PM on Wednesday, 17th September 2025.
📨 Received Deepgram JSON message: {"type":"History","role":"assistant","content":"Your appointment has been moved to 2 PM on Wednesday, 17th September 2025."}...
Message string: {"type":"History","role":"assistant","content":"Your appointment has been moved to 2 PM on Wednesday, 17th September 2025."}
[2025-09-15T09:38:53.880Z] 📨 JSON MESSAGE FROM DEEPGRAM: {"type":"History","role":"assistant","content":"Your appointment has been moved to 2 PM on Wednesday, 17th September 2025."}
[2025-09-15T09:38:53.880Z] === PARSED DEEPGRAM JSON ===
{
  "type": "History",
  "role": "assistant",
  "content": "Your appointment has been moved to 2 PM on Wednesday, 17th September 2025."
}
[2025-09-15T09:38:53.880Z] === END PARSED JSON ===
[2025-09-15T09:38:53.880Z] 🎯 DEEPGRAM EVENT TYPE: History
[2025-09-15T09:38:53.880Z] 📜 HISTORY: Message logged
[2025-09-15T09:38:53.880Z] 🔍 History role: 'assistant' -> Speaker: 'AI'
📝 TRANSCRIPT: Skipping duplicate AI: Your appointment has been moved to 2 PM on Wednesday, 17th September 2025.
[2025-09-15T09:38:53.880Z] 📝 Added transcript: [AI] Your appointment has been moved to 2 PM on Wednesday, 17th September 2025.
[2025-09-15T09:38:53.880Z] 🎵 Starting audio stream - feeding buffer
[2025-09-15T09:38:56.148Z] 🔇 Audio stream ended (timeout)
[2025-09-15T09:38:57.631Z] 💓 KEEPALIVE: Sent to Deepgram
📨 Received Deepgram JSON message: {"type":"ConversationText","role":"assistant","content":"Just to confirm, do you want this to be still a beard trim, or would you like to change the service to a haircut?"}...
Message string: {"type":"ConversationText","role":"assistant","content":"Just to confirm, do you want this to be still a beard trim, or would you like to change the service to a haircut?"}
[2025-09-15T09:38:59.442Z] 📨 JSON MESSAGE FROM DEEPGRAM: {"type":"ConversationText","role":"assistant","content":"Just to confirm, do you want this to be still a beard trim, or would you like to change the service to a haircut?"}
[2025-09-15T09:38:59.442Z] === PARSED DEEPGRAM JSON ===
{
  "type": "ConversationText",
  "role": "assistant",
  "content": "Just to confirm, do you want this to be still a beard trim, or would you like to change the service to a haircut?"
}
[2025-09-15T09:38:59.442Z] === END PARSED JSON ===
[2025-09-15T09:38:59.442Z] 🎯 DEEPGRAM EVENT TYPE: ConversationText
[2025-09-15T09:38:59.442Z] 💭 CONVERSATION_TEXT: Just to confirm, do you want this to be still a beard trim, or would you like to change the service to a haircut?
[2025-09-15T09:38:59.442Z] 🔍 ConversationText role: 'assistant' -> Speaker: 'AI'
📝 TRANSCRIPT: Added AI: Just to confirm, do you want this to be still a beard trim, or would you like to change the service to a haircut?
📨 Received Deepgram JSON message: {"type":"History","role":"assistant","content":"Just to confirm, do you want this to be still a beard trim, or would you like to change the service to a haircut?"}...
Message string: {"type":"History","role":"assistant","content":"Just to confirm, do you want this to be still a beard trim, or would you like to change the service to a haircut?"}
[2025-09-15T09:38:59.591Z] 📨 JSON MESSAGE FROM DEEPGRAM: {"type":"History","role":"assistant","content":"Just to confirm, do you want this to be still a beard trim, or would you like to change the service to a haircut?"}
[2025-09-15T09:38:59.591Z] === PARSED DEEPGRAM JSON ===
{
  "type": "History",
  "role": "assistant",
  "content": "Just to confirm, do you want this to be still a beard trim, or would you like to change the service to a haircut?"
}
[2025-09-15T09:38:59.591Z] === END PARSED JSON ===
[2025-09-15T09:38:59.591Z] 🎯 DEEPGRAM EVENT TYPE: History
[2025-09-15T09:38:59.591Z] 📜 HISTORY: Message logged
[2025-09-15T09:38:59.591Z] 🔍 History role: 'assistant' -> Speaker: 'AI'
📝 TRANSCRIPT: Skipping duplicate AI: Just to confirm, do you want this to be still a beard trim, or would you like to change the service to a haircut?
[2025-09-15T09:38:59.591Z] 📝 Added transcript: [AI] Just to confirm, do you want this to be still a beard trim, or would you like to change the service to a haircut?
[2025-09-15T09:38:59.591Z] 🎵 Starting audio stream - feeding buffer
📨 Received Deepgram JSON message: {"type":"AgentAudioDone"}...
Message string: {"type":"AgentAudioDone"}
[2025-09-15T09:38:59.739Z] 📨 JSON MESSAGE FROM DEEPGRAM: {"type":"AgentAudioDone"}
[2025-09-15T09:38:59.739Z] === PARSED DEEPGRAM JSON ===
{
  "type": "AgentAudioDone"
}
[2025-09-15T09:38:59.739Z] === END PARSED JSON ===
[2025-09-15T09:38:59.739Z] 🎯 DEEPGRAM EVENT TYPE: AgentAudioDone
[2025-09-15T09:38:59.739Z] 🔇 AGENT_AUDIO_DONE: AI finished sending audio
[2025-09-15T09:38:59.739Z] 🔇 SILENCE: Started tracking
[2025-09-15T09:38:59.739Z] ✅ Agent speech ended. Pacer will now send silence until next utterance.
[2025-09-15T09:38:59.739Z] 🔇 SILENCE_CHECK: 1000ms of silence
[2025-09-15T09:39:01.631Z] 💓 KEEPALIVE: Sent to Deepgram
[2025-09-15T09:38:59.739Z] 🔇 SILENCE_CHECK: 2001ms of silence
[2025-09-15T09:38:59.739Z] 🔇 SILENCE_CHECK: 3000ms of silence
[2025-09-15T09:38:59.739Z] 🔇 SILENCE_CHECK: 4001ms of silence
[2025-09-15T09:38:59.739Z] 🔇 SILENCE_CHECK: 5001ms of silence
[2025-09-15T09:39:05.631Z] 💓 KEEPALIVE: Sent to Deepgram
[2025-09-15T09:38:59.739Z] 🔇 SILENCE_CHECK: 6001ms of silence
[2025-09-15T09:38:59.739Z] 🔇 SILENCE_CHECK: 7002ms of silence
📨 Received Deepgram JSON message: {"type":"UserStartedSpeaking"}...
Message string: {"type":"UserStartedSpeaking"}
[2025-09-15T09:39:07.495Z] 📨 JSON MESSAGE FROM DEEPGRAM: {"type":"UserStartedSpeaking"}
[2025-09-15T09:39:07.495Z] === PARSED DEEPGRAM JSON ===
{
  "type": "UserStartedSpeaking"
}
[2025-09-15T09:39:07.495Z] === END PARSED JSON ===
[2025-09-15T09:39:07.495Z] 🎯 DEEPGRAM EVENT TYPE: UserStartedSpeaking
[2025-09-15T09:39:07.495Z] 🎤 USER_STARTED_SPEAKING: User began speaking
[2025-09-15T09:39:07.495Z] 🔄 BARGE_IN: Cleared Twilio audio queue for user speech
[2025-09-15T09:39:07.495Z] 🔄 SILENCE_RESET: User speaking, silence tracking reset
[2025-09-15T09:39:09.631Z] 💓 KEEPALIVE: Sent to Deepgram
📨 Received Deepgram JSON message: {"type":"ConversationText","role":"user","content":"I want a beer trim."}...
Message string: {"type":"ConversationText","role":"user","content":"I want a beer trim."}
[2025-09-15T09:39:10.462Z] 📨 JSON MESSAGE FROM DEEPGRAM: {"type":"ConversationText","role":"user","content":"I want a beer trim."}
[2025-09-15T09:39:10.462Z] === PARSED DEEPGRAM JSON ===
{
  "type": "ConversationText",
  "role": "user",
  "content": "I want a beer trim."
}
[2025-09-15T09:39:10.462Z] === END PARSED JSON ===
[2025-09-15T09:39:10.462Z] 🎯 DEEPGRAM EVENT TYPE: ConversationText
[2025-09-15T09:39:10.462Z] 💭 CONVERSATION_TEXT: I want a beer trim.
[2025-09-15T09:39:10.462Z] 🔍 ConversationText role: 'user' -> Speaker: 'User'
📝 TRANSCRIPT: Added User: I want a beer trim.
📨 Received Deepgram JSON message: {"type":"History","role":"user","content":"I want a beer trim."}...
Message string: {"type":"History","role":"user","content":"I want a beer trim."}
[2025-09-15T09:39:10.468Z] 📨 JSON MESSAGE FROM DEEPGRAM: {"type":"History","role":"user","content":"I want a beer trim."}
[2025-09-15T09:39:10.468Z] === PARSED DEEPGRAM JSON ===
{
  "type": "History",
  "role": "user",
  "content": "I want a beer trim."
}
[2025-09-15T09:39:10.468Z] === END PARSED JSON ===
[2025-09-15T09:39:10.468Z] 🎯 DEEPGRAM EVENT TYPE: History
[2025-09-15T09:39:10.468Z] 📜 HISTORY: Message logged
[2025-09-15T09:39:10.468Z] 🔍 History role: 'user' -> Speaker: 'User'
📝 TRANSCRIPT: Skipping duplicate User: I want a beer trim.
[2025-09-15T09:39:10.468Z] 📝 Added transcript: [User] I want a beer trim.
📨 Received Deepgram JSON message: {"type":"UserStartedSpeaking"}...
Message string: {"type":"UserStartedSpeaking"}
[2025-09-15T09:39:10.775Z] 📨 JSON MESSAGE FROM DEEPGRAM: {"type":"UserStartedSpeaking"}
[2025-09-15T09:39:10.775Z] === PARSED DEEPGRAM JSON ===
{
  "type": "UserStartedSpeaking"
}
[2025-09-15T09:39:10.775Z] === END PARSED JSON ===
[2025-09-15T09:39:10.775Z] 🎯 DEEPGRAM EVENT TYPE: UserStartedSpeaking
[2025-09-15T09:39:10.775Z] 🎤 USER_STARTED_SPEAKING: User began speaking
[2025-09-15T09:39:10.775Z] 🔄 BARGE_IN: Cleared Twilio audio queue for user speech
[2025-09-15T09:39:10.775Z] 🔄 SILENCE_RESET: User speaking, silence tracking reset
📨 Received Deepgram JSON message: {"type":"ConversationText","role":"user","content":"Yeah. Just just leave it there."}...
Message string: {"type":"ConversationText","role":"user","content":"Yeah. Just just leave it there."}
[2025-09-15T09:39:13.024Z] 📨 JSON MESSAGE FROM DEEPGRAM: {"type":"ConversationText","role":"user","content":"Yeah. Just just leave it there."}
[2025-09-15T09:39:13.024Z] === PARSED DEEPGRAM JSON ===
{
  "type": "ConversationText",
  "role": "user",
  "content": "Yeah. Just just leave it there."
}
[2025-09-15T09:39:13.024Z] === END PARSED JSON ===
[2025-09-15T09:39:13.024Z] 🎯 DEEPGRAM EVENT TYPE: ConversationText
[2025-09-15T09:39:13.024Z] 💭 CONVERSATION_TEXT: Yeah. Just just leave it there.
[2025-09-15T09:39:13.024Z] 🔍 ConversationText role: 'user' -> Speaker: 'User'
📝 TRANSCRIPT: Added User: Yeah. Just just leave it there.
📨 Received Deepgram JSON message: {"type":"History","role":"user","content":"Yeah. Just just leave it there."}...
Message string: {"type":"History","role":"user","content":"Yeah. Just just leave it there."}
[2025-09-15T09:39:13.028Z] 📨 JSON MESSAGE FROM DEEPGRAM: {"type":"History","role":"user","content":"Yeah. Just just leave it there."}
[2025-09-15T09:39:13.028Z] === PARSED DEEPGRAM JSON ===
{
  "type": "History",
  "role": "user",
  "content": "Yeah. Just just leave it there."
}
[2025-09-15T09:39:13.028Z] === END PARSED JSON ===
[2025-09-15T09:39:13.028Z] 🎯 DEEPGRAM EVENT TYPE: History
[2025-09-15T09:39:13.028Z] 📜 HISTORY: Message logged
[2025-09-15T09:39:13.028Z] 🔍 History role: 'user' -> Speaker: 'User'
📝 TRANSCRIPT: Skipping duplicate User: Yeah. Just just leave it there.
[2025-09-15T09:39:13.028Z] 📝 Added transcript: [User] Yeah. Just just leave it there.
[2025-09-15T09:39:13.632Z] 💓 KEEPALIVE: Sent to Deepgram
📨 Received Deepgram JSON message: {"type":"FunctionCallRequest","functions":[{"id":"call_YsSUFU7L2ydIcHgzPCA3NgYf","name":"update_booking","arguments":"{\"new_service_id\":\"63555ab0-f0ac-48c3-a2b2-766356aeb8f4\"}","client_side":true}...
Message string: {"type":"FunctionCallRequest","functions":[{"id":"call_YsSUFU7L2ydIcHgzPCA3NgYf","name":"update_booking","arguments":"{\"new_service_id\":\"63555ab0-f0ac-48c3-a2b2-766356aeb8f4\"}","client_side":true}]}
[2025-09-15T09:39:14.225Z] 📨 JSON MESSAGE FROM DEEPGRAM: {"type":"FunctionCallRequest","functions":[{"id":"call_YsSUFU7L2ydIcHgzPCA3NgYf","name":"update_booking","arguments":"{\"new_service_id\":\"63555ab0-f0ac-48c3-a2b2-766356aeb8f4\"}","client_side":true}]}
[2025-09-15T09:39:14.225Z] === PARSED DEEPGRAM JSON ===
{
  "type": "FunctionCallRequest",
  "functions": [
    {
      "id": "call_YsSUFU7L2ydIcHgzPCA3NgYf",
      "name": "update_booking",
      "arguments": "{\"new_service_id\":\"63555ab0-f0ac-48c3-a2b2-766356aeb8f4\"}",
      "client_side": true
    }
  ]
}
[2025-09-15T09:39:14.225Z] === END PARSED JSON ===
[2025-09-15T09:39:14.225Z] 🎯 DEEPGRAM EVENT TYPE: FunctionCallRequest
[2025-09-15T09:39:14.225Z] 🚨🚨 FUNCTION_CALL_REQUEST DETECTED! 🚨🚨
[2025-09-15T09:39:14.225Z] ✅ SUCCESS: AI requesting function calls!
[2025-09-15T09:39:14.225Z] 📋 Functions: [
  {
    "id": "call_YsSUFU7L2ydIcHgzPCA3NgYf",
    "name": "update_booking",
    "arguments": "{\"new_service_id\":\"63555ab0-f0ac-48c3-a2b2-766356aeb8f4\"}",
    "client_side": true
  }
]
[2025-09-15T09:39:14.225Z] ⏸️ SILENCE: Pausing timer - Processing function calls
[2025-09-15T09:39:14.225Z] ⏸️ KEEPALIVE: Paused for function processing
[2025-09-15T09:39:14.225Z] 🔧 Processing function: update_booking
[2025-09-15T09:39:14.225Z] 🔧 CALLING: handleFunctionCall for update_booking...
📝 Session updated for call CA20b2d8268ce7b7a3ef3351f331ad95a0: {
  callerPhone: '+447468306825',
  customerName: 'Marco',
  lastBookingDate: '2025-09-17',
  lastBookingTime: '14:00',
  lastServiceId: '63555ab0-f0ac-48c3-a2b2-766356aeb8f4',
  lastServiceName: 'beard trim',
  lastServiceDuration: 15,
  bookings: [
    {
      customerName: 'Marco',
      date: '2025-09-18',
      time: '12:30',
      serviceId: '63555ab0-f0ac-48c3-a2b2-766356aeb8f4',
      serviceName: 'beard trim',
      serviceDuration: 15,
      appointmentId: '7c6e3a32-ae3e-42c9-97db-89a86e0525c7',
      type: 'create'
    },
    {
      customerName: 'Marco',
      currentDate: '2025-09-18',
      currentTime: '12:30',
      newDate: '2025-09-17',
      newTime: '12:45',
      newServiceId: undefined,
      type: 'update',
      finalDate: '2025-09-17',
      finalTime: '12:45:00',
      appointmentId: 'ee2b24b5-eff8-463b-ac9e-bfcf8d803a5a',
      serviceName: 'beard trim'
    },
    {
      customerName: 'Marco',
      currentDate: '2025-09-17',
      currentTime: '12:45',
      newDate: undefined,
      newTime: '14:00',
      newServiceId: undefined,
      type: 'update'
    },
    {
      customerName: 'Marco',
      currentDate: '2025-09-17',
      currentTime: '14:00',
      newDate: '2025-09-17',
      newTime: '14:00',
      newServiceId: undefined,
      type: 'update',
      finalDate: '2025-09-17',
      finalTime: '14:00:00',
      appointmentId: 'adaf6700-7750-45e7-86cb-9e42707b4654',
      serviceName: 'haircut'
    }
  ],
  lastAppointmentId: '7c6e3a32-ae3e-42c9-97db-89a86e0525c7'
}
[2025-09-15T09:39:14.225Z] 🚀 STARTING handleFunctionCall
[2025-09-15T09:39:14.225Z] 🔧 Function call received: {
  "function_name": "update_booking",
  "function_call_id": "call_YsSUFU7L2ydIcHgzPCA3NgYf",
  "parameters": {
    "new_service_id": "63555ab0-f0ac-48c3-a2b2-766356aeb8f4"
  }
}
[2025-09-15T09:39:14.225Z] 📋 Function name: update_booking
[2025-09-15T09:39:14.225Z] 📊 Parameters: {
  "new_service_id": "63555ab0-f0ac-48c3-a2b2-766356aeb8f4"
}
[2025-09-15T09:39:14.225Z] 🏢 Business config exists: true
[2025-09-15T09:39:14.225Z] 🌐 WebSocket state: 1
🔧 Function call received: {
  "function_name": "update_booking",
  "function_call_id": "call_YsSUFU7L2ydIcHgzPCA3NgYf",
  "parameters": {
    "new_service_id": "63555ab0-f0ac-48c3-a2b2-766356aeb8f4"
  }
}
📝 updateBooking called with params: {
  "new_service_id": "63555ab0-f0ac-48c3-a2b2-766356aeb8f4"
}
📋 Session data: {
  callerPhone: '+447468306825',
  customerName: 'Marco',
  lastBookingDate: '2025-09-17',
  lastBookingTime: '14:00',
  lastServiceId: '63555ab0-f0ac-48c3-a2b2-766356aeb8f4',
  lastServiceName: 'beard trim',
  lastServiceDuration: 15,
  bookings: [
    {
      customerName: 'Marco',
      date: '2025-09-18',
      time: '12:30',
      serviceId: '63555ab0-f0ac-48c3-a2b2-766356aeb8f4',
      serviceName: 'beard trim',
      serviceDuration: 15,
      appointmentId: '7c6e3a32-ae3e-42c9-97db-89a86e0525c7',
      type: 'create'
    },
    {
      customerName: 'Marco',
      currentDate: '2025-09-18',
      currentTime: '12:30',
      newDate: '2025-09-17',
      newTime: '12:45',
      newServiceId: undefined,
      type: 'update',
      finalDate: '2025-09-17',
      finalTime: '12:45:00',
      appointmentId: 'ee2b24b5-eff8-463b-ac9e-bfcf8d803a5a',
      serviceName: 'beard trim'
    },
    {
      customerName: 'Marco',
      currentDate: '2025-09-17',
      currentTime: '12:45',
      newDate: undefined,
      newTime: '14:00',
      newServiceId: undefined,
      type: 'update'
    },
    {
      customerName: 'Marco',
      currentDate: '2025-09-17',
      currentTime: '14:00',
      newDate: '2025-09-17',
      newTime: '14:00',
      newServiceId: undefined,
      type: 'update',
      finalDate: '2025-09-17',
      finalTime: '14:00:00',
      appointmentId: 'adaf6700-7750-45e7-86cb-9e42707b4654',
      serviceName: 'haircut'
    }
  ],
  lastAppointmentId: '7c6e3a32-ae3e-42c9-97db-89a86e0525c7'
}
🔄 Using customer info: {
  customerName: 'Marco',
  currentDate: '2025-09-17',
  currentTime: '14:00'
}
📞 Caller phone: +447468306825
👤 Customer: Marco
📅 Booking: 2025-09-17 at 14:00
📝 Session updated for call CA20b2d8268ce7b7a3ef3351f331ad95a0: {
  callerPhone: '+447468306825',
  customerName: 'Marco',
  lastBookingDate: '2025-09-17',
  lastBookingTime: '14:00',
  lastServiceId: '63555ab0-f0ac-48c3-a2b2-766356aeb8f4',
  lastServiceName: 'beard trim',
  lastServiceDuration: 15,
  bookings: [
    {
      customerName: 'Marco',
      date: '2025-09-18',
      time: '12:30',
      serviceId: '63555ab0-f0ac-48c3-a2b2-766356aeb8f4',
      serviceName: 'beard trim',
      serviceDuration: 15,
      appointmentId: '7c6e3a32-ae3e-42c9-97db-89a86e0525c7',
      type: 'create'
    },
    {
      customerName: 'Marco',
      currentDate: '2025-09-18',
      currentTime: '12:30',
      newDate: '2025-09-17',
      newTime: '12:45',
      newServiceId: undefined,
      type: 'update',
      finalDate: '2025-09-17',
      finalTime: '12:45:00',
      appointmentId: 'ee2b24b5-eff8-463b-ac9e-bfcf8d803a5a',
      serviceName: 'beard trim'
    },
    {
      customerName: 'Marco',
      currentDate: '2025-09-17',
      currentTime: '12:45',
      newDate: undefined,
      newTime: '14:00',
      newServiceId: undefined,
      type: 'update'
    },
    {
      customerName: 'Marco',
      currentDate: '2025-09-17',
      currentTime: '14:00',
      newDate: '2025-09-17',
      newTime: '14:00',
      newServiceId: undefined,
      type: 'update',
      finalDate: '2025-09-17',
      finalTime: '14:00:00',
      appointmentId: 'adaf6700-7750-45e7-86cb-9e42707b4654',
      serviceName: 'haircut'
    },
    {
      customerName: 'Marco',
      currentDate: '2025-09-17',
      currentTime: '14:00',
      newDate: undefined,
      newTime: undefined,
      newServiceId: '63555ab0-f0ac-48c3-a2b2-766356aeb8f4',
      type: 'update'
    }
  ],
  lastAppointmentId: '7c6e3a32-ae3e-42c9-97db-89a86e0525c7'
}
📦 Update request body: {
  "business_id": "1bb3c552-053f-40c4-b3f2-bdb51af87b52",
  "customer_name": "Marco",
  "current_date": "2025-09-17",
  "current_time": "14:00",
  "caller_phone": "+447468306825",
  "new_service_id": "63555ab0-f0ac-48c3-a2b2-766356aeb8f4"
}
📨 Received Deepgram JSON message: {"type":"UserStartedSpeaking"}...
Message string: {"type":"UserStartedSpeaking"}
[2025-09-15T09:39:14.475Z] 📨 JSON MESSAGE FROM DEEPGRAM: {"type":"UserStartedSpeaking"}
[2025-09-15T09:39:14.475Z] === PARSED DEEPGRAM JSON ===
{
  "type": "UserStartedSpeaking"
}
[2025-09-15T09:39:14.475Z] === END PARSED JSON ===
[2025-09-15T09:39:14.475Z] 🎯 DEEPGRAM EVENT TYPE: UserStartedSpeaking
[2025-09-15T09:39:14.475Z] 🎤 USER_STARTED_SPEAKING: User began speaking
[2025-09-15T09:39:14.475Z] 🔄 BARGE_IN: Cleared Twilio audio queue for user speech
[2025-09-15T09:39:14.475Z] 🔄 SILENCE_RESET: User speaking, silence tracking reset
📨 Received Deepgram JSON message: {"type":"ConversationText","role":"user","content":"Okay. And I also want a haircut for"}...
Message string: {"type":"ConversationText","role":"user","content":"Okay. And I also want a haircut for"}
[2025-09-15T09:39:16.828Z] 📨 JSON MESSAGE FROM DEEPGRAM: {"type":"ConversationText","role":"user","content":"Okay. And I also want a haircut for"}
[2025-09-15T09:39:16.828Z] === PARSED DEEPGRAM JSON ===
{
  "type": "ConversationText",
  "role": "user",
  "content": "Okay. And I also want a haircut for"
}
[2025-09-15T09:39:16.828Z] === END PARSED JSON ===
[2025-09-15T09:39:16.828Z] 🎯 DEEPGRAM EVENT TYPE: ConversationText
[2025-09-15T09:39:16.828Z] 💭 CONVERSATION_TEXT: Okay. And I also want a haircut for
[2025-09-15T09:39:16.828Z] 🔍 ConversationText role: 'user' -> Speaker: 'User'
📝 TRANSCRIPT: Added User: Okay. And I also want a haircut for
📨 Received Deepgram JSON message: {"type":"History","role":"user","content":"Okay. And I also want a haircut for"}...
Message string: {"type":"History","role":"user","content":"Okay. And I also want a haircut for"}
[2025-09-15T09:39:16.847Z] 📨 JSON MESSAGE FROM DEEPGRAM: {"type":"History","role":"user","content":"Okay. And I also want a haircut for"}
[2025-09-15T09:39:16.847Z] === PARSED DEEPGRAM JSON ===
{
  "type": "History",
  "role": "user",
  "content": "Okay. And I also want a haircut for"
}
[2025-09-15T09:39:16.847Z] === END PARSED JSON ===
[2025-09-15T09:39:16.847Z] 🎯 DEEPGRAM EVENT TYPE: History
[2025-09-15T09:39:16.847Z] 📜 HISTORY: Message logged
[2025-09-15T09:39:16.847Z] 🔍 History role: 'user' -> Speaker: 'User'
📝 TRANSCRIPT: Skipping duplicate User: Okay. And I also want a haircut for
[2025-09-15T09:39:16.847Z] 📝 Added transcript: [User] Okay. And I also want a haircut for
✅ Booking updated successfully: {
  success: true,
  message: 'Booking updated successfully',
  booking: {
    id: '4ca68442-2f04-486e-998f-9e945845cc4b',
    customer_name: 'Marco',
    service_name: 'beard trim',
    date: '2025-09-17',
    start_time: '14:00:00',
    end_time: '13:15:00',
    status: 'confirmed'
  }
}
📝 Session updated for call CA20b2d8268ce7b7a3ef3351f331ad95a0: {
  callerPhone: '+447468306825',
  customerName: 'Marco',
  lastBookingDate: '2025-09-17',
  lastBookingTime: '14:00',
  lastServiceId: '63555ab0-f0ac-48c3-a2b2-766356aeb8f4',
  lastServiceName: 'beard trim',
  lastServiceDuration: 15,
  bookings: [
    {
      customerName: 'Marco',
      date: '2025-09-18',
      time: '12:30',
      serviceId: '63555ab0-f0ac-48c3-a2b2-766356aeb8f4',
      serviceName: 'beard trim',
      serviceDuration: 15,
      appointmentId: '7c6e3a32-ae3e-42c9-97db-89a86e0525c7',
      type: 'create'
    },
    {
      customerName: 'Marco',
      currentDate: '2025-09-18',
      currentTime: '12:30',
      newDate: '2025-09-17',
      newTime: '12:45',
      newServiceId: undefined,
      type: 'update',
      finalDate: '2025-09-17',
      finalTime: '12:45:00',
      appointmentId: 'ee2b24b5-eff8-463b-ac9e-bfcf8d803a5a',
      serviceName: 'beard trim'
    },
    {
      customerName: 'Marco',
      currentDate: '2025-09-17',
      currentTime: '12:45',
      newDate: undefined,
      newTime: '14:00',
      newServiceId: undefined,
      type: 'update'
    },
    {
      customerName: 'Marco',
      currentDate: '2025-09-17',
      currentTime: '14:00',
      newDate: '2025-09-17',
      newTime: '14:00',
      newServiceId: undefined,
      type: 'update',
      finalDate: '2025-09-17',
      finalTime: '14:00:00',
      appointmentId: 'adaf6700-7750-45e7-86cb-9e42707b4654',
      serviceName: 'haircut'
    },
    {
      customerName: 'Marco',
      currentDate: '2025-09-17',
      currentTime: '14:00',
      newDate: undefined,
      newTime: undefined,
      newServiceId: '63555ab0-f0ac-48c3-a2b2-766356aeb8f4',
      type: 'update',
      finalDate: '2025-09-17',
      finalTime: '14:00:00',
      appointmentId: '4ca68442-2f04-486e-998f-9e945845cc4b',
      serviceName: 'beard trim'
    }
  ],
  lastAppointmentId: '7c6e3a32-ae3e-42c9-97db-89a86e0525c7'
}
✅ Sending update_booking response to Deepgram
✅ Function response sent successfully to Deepgram
🔄 Waiting for Deepgram to process the response...
📨 Received Deepgram JSON message: {"type":"UserStartedSpeaking"}...
Message string: {"type":"UserStartedSpeaking"}
[2025-09-15T09:39:17.337Z] 📨 JSON MESSAGE FROM DEEPGRAM: {"type":"UserStartedSpeaking"}
[2025-09-15T09:39:17.337Z] === PARSED DEEPGRAM JSON ===
{
  "type": "UserStartedSpeaking"
}
[2025-09-15T09:39:17.337Z] === END PARSED JSON ===
[2025-09-15T09:39:17.337Z] 🎯 DEEPGRAM EVENT TYPE: UserStartedSpeaking
[2025-09-15T09:39:17.337Z] 🎤 USER_STARTED_SPEAKING: User began speaking
[2025-09-15T09:39:17.337Z] 🔄 BARGE_IN: Cleared Twilio audio queue for user speech
[2025-09-15T09:39:17.337Z] 🔄 SILENCE_RESET: User speaking, silence tracking reset
[2025-09-15T09:39:14.225Z] ✅ COMPLETED: handleFunctionCall for update_booking
[2025-09-15T09:39:17.985Z] ▶️ KEEPALIVE: Resumed after function processing
[2025-09-15T09:39:14.225Z] ▶️ SILENCE: Resuming timer - Function processing completed
📨 Received Deepgram JSON message: {"type":"ConversationText","role":"user","content":"Thursday at two PM."}...
Message string: {"type":"ConversationText","role":"user","content":"Thursday at two PM."}
[2025-09-15T09:39:18.783Z] 📨 JSON MESSAGE FROM DEEPGRAM: {"type":"ConversationText","role":"user","content":"Thursday at two PM."}
[2025-09-15T09:39:18.783Z] === PARSED DEEPGRAM JSON ===
{
  "type": "ConversationText",
  "role": "user",
  "content": "Thursday at two PM."
}
[2025-09-15T09:39:18.783Z] === END PARSED JSON ===
[2025-09-15T09:39:18.783Z] 🎯 DEEPGRAM EVENT TYPE: ConversationText
[2025-09-15T09:39:18.783Z] 💭 CONVERSATION_TEXT: Thursday at two PM.
[2025-09-15T09:39:18.783Z] 🔍 ConversationText role: 'user' -> Speaker: 'User'
📝 TRANSCRIPT: Added User: Thursday at two PM.
📨 Received Deepgram JSON message: {"type":"History","role":"user","content":"Thursday at two PM."}...
Message string: {"type":"History","role":"user","content":"Thursday at two PM."}
[2025-09-15T09:39:18.787Z] 📨 JSON MESSAGE FROM DEEPGRAM: {"type":"History","role":"user","content":"Thursday at two PM."}
[2025-09-15T09:39:18.787Z] === PARSED DEEPGRAM JSON ===
{
  "type": "History",
  "role": "user",
  "content": "Thursday at two PM."
}
[2025-09-15T09:39:18.787Z] === END PARSED JSON ===
[2025-09-15T09:39:18.787Z] 🎯 DEEPGRAM EVENT TYPE: History
[2025-09-15T09:39:18.787Z] 📜 HISTORY: Message logged
[2025-09-15T09:39:18.787Z] 🔍 History role: 'user' -> Speaker: 'User'
📝 TRANSCRIPT: Skipping duplicate User: Thursday at two PM.
[2025-09-15T09:39:18.787Z] 📝 Added transcript: [User] Thursday at two PM.
📨 Received Deepgram JSON message: {"type":"FunctionCallRequest","functions":[{"id":"call_VXKnwaMLST1vL0CBTpYfDuDF","name":"get_available_slots","arguments":"{\"date\":\"2025-09-18\",\"service_id\":\"4395775e-fa81-4a69-8425-e46c3853dea...
Message string: {"type":"FunctionCallRequest","functions":[{"id":"call_VXKnwaMLST1vL0CBTpYfDuDF","name":"get_available_slots","arguments":"{\"date\":\"2025-09-18\",\"service_id\":\"4395775e-fa81-4a69-8425-e46c3853dea4\"}","client_side":true}]}
[2025-09-15T09:39:19.774Z] 📨 JSON MESSAGE FROM DEEPGRAM: {"type":"FunctionCallRequest","functions":[{"id":"call_VXKnwaMLST1vL0CBTpYfDuDF","name":"get_available_slots","arguments":"{\"date\":\"2025-09-18\",\"service_id\":\"4395775e-fa81-4a69-8425-e46c3853dea4\"}","client_side":true}]}
[2025-09-15T09:39:19.774Z] === PARSED DEEPGRAM JSON ===
{
  "type": "FunctionCallRequest",
  "functions": [
    {
      "id": "call_VXKnwaMLST1vL0CBTpYfDuDF",
      "name": "get_available_slots",
      "arguments": "{\"date\":\"2025-09-18\",\"service_id\":\"4395775e-fa81-4a69-8425-e46c3853dea4\"}",
      "client_side": true
    }
  ]
}
[2025-09-15T09:39:19.774Z] === END PARSED JSON ===
[2025-09-15T09:39:19.774Z] 🎯 DEEPGRAM EVENT TYPE: FunctionCallRequest
[2025-09-15T09:39:19.774Z] 🚨🚨 FUNCTION_CALL_REQUEST DETECTED! 🚨🚨
[2025-09-15T09:39:19.774Z] ✅ SUCCESS: AI requesting function calls!
[2025-09-15T09:39:19.774Z] 📋 Functions: [
  {
    "id": "call_VXKnwaMLST1vL0CBTpYfDuDF",
    "name": "get_available_slots",
    "arguments": "{\"date\":\"2025-09-18\",\"service_id\":\"4395775e-fa81-4a69-8425-e46c3853dea4\"}",
    "client_side": true
  }
]
[2025-09-15T09:39:19.774Z] ⏸️ SILENCE: Pausing timer - Processing function calls
[2025-09-15T09:39:19.774Z] ⏸️ KEEPALIVE: Paused for function processing
[2025-09-15T09:39:19.774Z] 🔧 Processing function: get_available_slots
[2025-09-15T09:39:19.774Z] 🔧 CALLING: handleFunctionCall for get_available_slots...
📝 Session updated for call CA20b2d8268ce7b7a3ef3351f331ad95a0: {
  callerPhone: '+447468306825',
  customerName: 'Marco',
  lastBookingDate: '2025-09-17',
  lastBookingTime: '14:00',
  lastServiceId: '63555ab0-f0ac-48c3-a2b2-766356aeb8f4',
  lastServiceName: 'beard trim',
  lastServiceDuration: 15,
  bookings: [
    {
      customerName: 'Marco',
      date: '2025-09-18',
      time: '12:30',
      serviceId: '63555ab0-f0ac-48c3-a2b2-766356aeb8f4',
      serviceName: 'beard trim',
      serviceDuration: 15,
      appointmentId: '7c6e3a32-ae3e-42c9-97db-89a86e0525c7',
      type: 'create'
    },
    {
      customerName: 'Marco',
      currentDate: '2025-09-18',
      currentTime: '12:30',
      newDate: '2025-09-17',
      newTime: '12:45',
      newServiceId: undefined,
      type: 'update',
      finalDate: '2025-09-17',
      finalTime: '12:45:00',
      appointmentId: 'ee2b24b5-eff8-463b-ac9e-bfcf8d803a5a',
      serviceName: 'beard trim'
    },
    {
      customerName: 'Marco',
      currentDate: '2025-09-17',
      currentTime: '12:45',
      newDate: undefined,
      newTime: '14:00',
      newServiceId: undefined,
      type: 'update'
    },
    {
      customerName: 'Marco',
      currentDate: '2025-09-17',
      currentTime: '14:00',
      newDate: '2025-09-17',
      newTime: '14:00',
      newServiceId: undefined,
      type: 'update',
      finalDate: '2025-09-17',
      finalTime: '14:00:00',
      appointmentId: 'adaf6700-7750-45e7-86cb-9e42707b4654',
      serviceName: 'haircut'
    },
    {
      customerName: 'Marco',
      currentDate: '2025-09-17',
      currentTime: '14:00',
      newDate: undefined,
      newTime: undefined,
      newServiceId: '63555ab0-f0ac-48c3-a2b2-766356aeb8f4',
      type: 'update',
      finalDate: '2025-09-17',
      finalTime: '14:00:00',
      appointmentId: '4ca68442-2f04-486e-998f-9e945845cc4b',
      serviceName: 'beard trim'
    }
  ],
  lastAppointmentId: '7c6e3a32-ae3e-42c9-97db-89a86e0525c7'
}
[2025-09-15T09:39:19.775Z] 🚀 STARTING handleFunctionCall
[2025-09-15T09:39:19.775Z] 🔧 Function call received: {
  "function_name": "get_available_slots",
  "function_call_id": "call_VXKnwaMLST1vL0CBTpYfDuDF",
  "parameters": {
    "date": "2025-09-18",
    "service_id": "4395775e-fa81-4a69-8425-e46c3853dea4"
  }
}
[2025-09-15T09:39:19.775Z] 📋 Function name: get_available_slots
[2025-09-15T09:39:19.775Z] 📊 Parameters: {
  "date": "2025-09-18",
  "service_id": "4395775e-fa81-4a69-8425-e46c3853dea4"
}
[2025-09-15T09:39:19.775Z] 🏢 Business config exists: true
[2025-09-15T09:39:19.775Z] 🌐 WebSocket state: 1
🔧 Function call received: {
  "function_name": "get_available_slots",
  "function_call_id": "call_VXKnwaMLST1vL0CBTpYfDuDF",
  "parameters": {
    "date": "2025-09-18",
    "service_id": "4395775e-fa81-4a69-8425-e46c3853dea4"
  }
}
[2025-09-15T09:39:19.775Z] 🚀 STARTING getAvailableSlots with params: {
  "date": "2025-09-18",
  "service_id": "4395775e-fa81-4a69-8425-e46c3853dea4"
}
[2025-09-15T09:39:19.775Z] 🏢 Business config: Gents Barbershop
[2025-09-15T09:39:19.775Z] 📋 Services count: 2
[2025-09-15T09:39:19.775Z] 🌐 Site URL: https://www.vocalenda.com
[2025-09-15T09:39:19.775Z] 🔑 Secret exists: true
🗓️ Getting available slots for: {
  "date": "2025-09-18",
  "service_id": "4395775e-fa81-4a69-8425-e46c3853dea4"
}
📅 Business open on Thursday
📋 Using service: haircut (Duration: 30 minutes)
[2025-09-15T09:39:19.775Z] 🌐 About to make API call:
[2025-09-15T09:39:19.775Z] 🔗 API URL: https://www.vocalenda.com/api/calendar/availability?businessId=1bb3c552-053f-40c4-b3f2-bdb51af87b52&serviceId=4395775e-fa81-4a69-8425-e46c3853dea4&date=2025-09-18
[2025-09-15T09:39:19.775Z] 🔑 Secret exists: true
[2025-09-15T09:39:19.775Z] 🏢 Business ID: 1bb3c552-053f-40c4-b3f2-bdb51af87b52
[2025-09-15T09:39:19.775Z] 📋 Service ID: 4395775e-fa81-4a69-8425-e46c3853dea4
[2025-09-15T09:39:19.775Z] 📅 Date: 2025-09-18
[2025-09-15T09:39:19.775Z] 📡 API Response status: 200
[2025-09-15T09:39:19.775Z] 📡 API Response ok: true
[2025-09-15T09:39:19.775Z] 📅 Calendar API response: {
  "slots": [
    {
      "start": "2025-09-18T08:00:00.000Z",
      "end": "2025-09-18T08:30:00.000Z",
      "startTime": "09:00",
      "endTime": "09:30"
    },
    {
      "start": "2025-09-18T08:15:00.000Z",
      "end": "2025-09-18T08:45:00.000Z",
      "startTime": "09:15",
      "endTime": "09:45"
    },
    {
      "start": "2025-09-18T08:30:00.000Z",
      "end": "2025-09-18T09:00:00.000Z",
      "startTime": "09:30",
      "endTime": "10:00"
    },
    {
      "start": "2025-09-18T08:45:00.000Z",
      "end": "2025-09-18T09:15:00.000Z",
      "startTime": "09:45",
      "endTime": "10:15"
    },
    {
      "start": "2025-09-18T09:00:00.000Z",
      "end": "2025-09-18T09:30:00.000Z",
      "startTime": "10:00",
      "endTime": "10:30"
    },
    {
      "start": "2025-09-18T09:15:00.000Z",
      "end": "2025-09-18T09:45:00.000Z",
      "startTime": "10:15",
      "endTime": "10:45"
    },
    {
      "start": "2025-09-18T09:30:00.000Z",
      "end": "2025-09-18T10:00:00.000Z",
      "startTime": "10:30",
      "endTime": "11:00"
    },
    {
      "start": "2025-09-18T09:45:00.000Z",
      "end": "2025-09-18T10:15:00.000Z",
      "startTime": "10:45",
      "endTime": "11:15"
    },
    {
      "start": "2025-09-18T10:00:00.000Z",
      "end": "2025-09-18T10:30:00.000Z",
      "startTime": "11:00",
      "endTime": "11:30"
    },
    {
      "start": "2025-09-18T10:15:00.000Z",
      "end": "2025-09-18T10:45:00.000Z",
      "startTime": "11:15",
      "endTime": "11:45"
    },
    {
      "start": "2025-09-18T10:30:00.000Z",
      "end": "2025-09-18T11:00:00.000Z",
      "startTime": "11:30",
      "endTime": "12:00"
    },
    {
      "start": "2025-09-18T12:15:00.000Z",
      "end": "2025-09-18T12:45:00.000Z",
      "startTime": "13:15",
      "endTime": "13:45"
    },
    {
      "start": "2025-09-18T12:30:00.000Z",
      "end": "2025-09-18T13:00:00.000Z",
      "startTime": "13:30",
      "endTime": "14:00"
    },
    {
      "start": "2025-09-18T13:30:00.000Z",
      "end": "2025-09-18T14:00:00.000Z",
      "startTime": "14:30",
      "endTime": "15:00"
    },
    {
      "start": "2025-09-18T13:45:00.000Z",
      "end": "2025-09-18T14:15:00.000Z",
      "startTime": "14:45",
      "endTime": "15:15"
    },
    {
      "start": "2025-09-18T14:00:00.000Z",
      "end": "2025-09-18T14:30:00.000Z",
      "startTime": "15:00",
      "endTime": "15:30"
    },
    {
      "start": "2025-09-18T14:15:00.000Z",
      "end": "2025-09-18T14:45:00.000Z",
      "startTime": "15:15",
      "endTime": "15:45"
    },
    {
      "start": "2025-09-18T14:30:00.000Z",
      "end": "2025-09-18T15:00:00.000Z",
      "startTime": "15:30",
      "endTime": "16:00"
    },
    {
      "start": "2025-09-18T14:45:00.000Z",
      "end": "2025-09-18T15:15:00.000Z",
      "startTime": "15:45",
      "endTime": "16:15"
    },
    {
      "start": "2025-09-18T15:00:00.000Z",
      "end": "2025-09-18T15:30:00.000Z",
      "startTime": "16:00",
      "endTime": "16:30"
    },
    {
      "start": "2025-09-18T15:15:00.000Z",
      "end": "2025-09-18T15:45:00.000Z",
      "startTime": "16:15",
      "endTime": "16:45"
    },
    {
      "start": "2025-09-18T15:30:00.000Z",
      "end": "2025-09-18T16:00:00.000Z",
      "startTime": "16:30",
      "endTime": "17:00"
    }
  ],
  "date": "2025-09-18",
  "businessId": "1bb3c552-053f-40c4-b3f2-bdb51af87b52",
  "serviceId": "4395775e-fa81-4a69-8425-e46c3853dea4"
}
[2025-09-15T09:39:19.775Z] 📊 Response type: object
[2025-09-15T09:39:19.775Z] 📊 Has slots: true
[2025-09-15T09:39:19.775Z] 📊 Slots count: 22
✅ Available time slots: [
  '09:00', '09:15', '09:30',
  '09:45', '10:00', '10:15',
  '10:30', '10:45', '11:00',
  '11:15', '11:30', '13:15',
  '13:30', '14:30', '14:45',
  '15:00', '15:15', '15:30',
  '15:45', '16:00', '16:15',
  '16:30'
]
✅ Sending get_available_slots response to Deepgram
✅ Function response sent successfully to Deepgram
🔄 Waiting for Deepgram to process the response...
📨 Received Deepgram JSON message: {"type":"History","function_calls":[{"id":"call_VXKnwaMLST1vL0CBTpYfDuDF","name":"get_available_slots","client_side":true,"arguments":"{\"date\":\"2025-09-18\",\"service_id\":\"4395775e-fa81-4a69-8425...
Message string: {"type":"History","function_calls":[{"id":"call_VXKnwaMLST1vL0CBTpYfDuDF","name":"get_available_slots","client_side":true,"arguments":"{\"date\":\"2025-09-18\",\"service_id\":\"4395775e-fa81-4a69-8425-e46c3853dea4\"}","response":"{\"available_slots\":[\"09:00\",\"09:15\",\"09:30\",\"09:45\",\"10:00\",\"10:15\",\"10:30\",\"10:45\",\"11:00\",\"11:15\",\"11:30\",\"13:15\",\"13:30\",\"14:30\",\"14:45\",\"15:00\",\"15:15\",\"15:30\",\"15:45\",\"16:00\",\"16:15\",\"16:30\"]}"}]}
[2025-09-15T09:39:21.134Z] 📨 JSON MESSAGE FROM DEEPGRAM: {"type":"History","function_calls":[{"id":"call_VXKnwaMLST1vL0CBTpYfDuDF","name":"get_available_slots","client_side":true,"arguments":"{\"date\":\"2025-09-18\",\"service_id\":\"4395775e-fa81-4a69-8425-e46c3853dea4\"}","response":"{\"available_slots\":[\"09:00\",\"09:15\",\"09:30\",\"09:45\",\"10:00\",\"10:15\",\"10:30\",\"10:45\",\"11:00\",\"11:15\",\"11:30\",\"13:15\",\"13:30\",\"14:30\",\"14:45\",\"15:00\",\"15:15\",\"15:30\",\"15:45\",\"16:00\",\"16:15\",\"16:30\"]}"}]}
[2025-09-15T09:39:21.134Z] === PARSED DEEPGRAM JSON ===
{
  "type": "History",
  "function_calls": [
    {
      "id": "call_VXKnwaMLST1vL0CBTpYfDuDF",
      "name": "get_available_slots",
      "client_side": true,
      "arguments": "{\"date\":\"2025-09-18\",\"service_id\":\"4395775e-fa81-4a69-8425-e46c3853dea4\"}",
      "response": "{\"available_slots\":[\"09:00\",\"09:15\",\"09:30\",\"09:45\",\"10:00\",\"10:15\",\"10:30\",\"10:45\",\"11:00\",\"11:15\",\"11:30\",\"13:15\",\"13:30\",\"14:30\",\"14:45\",\"15:00\",\"15:15\",\"15:30\",\"15:45\",\"16:00\",\"16:15\",\"16:30\"]}"
    }
  ]
}
[2025-09-15T09:39:21.134Z] === END PARSED JSON ===
[2025-09-15T09:39:21.134Z] 🎯 DEEPGRAM EVENT TYPE: History
[2025-09-15T09:39:21.134Z] 📜 HISTORY: Message logged
[2025-09-15T09:39:19.774Z] ✅ COMPLETED: handleFunctionCall for get_available_slots
[2025-09-15T09:39:21.987Z] ▶️ KEEPALIVE: Resumed after function processing
[2025-09-15T09:39:19.774Z] ▶️ SILENCE: Resuming timer - Function processing completed
📨 Received Deepgram JSON message: {"type":"ConversationText","role":"assistant","content":"For the haircut on Thursday, 18th September 2025 at 2 PM, that time isn't available."}...
Message string: {"type":"ConversationText","role":"assistant","content":"For the haircut on Thursday, 18th September 2025 at 2 PM, that time isn't available."}
[2025-09-15T09:39:22.083Z] 📨 JSON MESSAGE FROM DEEPGRAM: {"type":"ConversationText","role":"assistant","content":"For the haircut on Thursday, 18th September 2025 at 2 PM, that time isn't available."}
[2025-09-15T09:39:22.083Z] === PARSED DEEPGRAM JSON ===
{
  "type": "ConversationText",
  "role": "assistant",
  "content": "For the haircut on Thursday, 18th September 2025 at 2 PM, that time isn't available."
}
[2025-09-15T09:39:22.083Z] === END PARSED JSON ===
[2025-09-15T09:39:22.083Z] 🎯 DEEPGRAM EVENT TYPE: ConversationText
[2025-09-15T09:39:22.083Z] 💭 CONVERSATION_TEXT: For the haircut on Thursday, 18th September 2025 at 2 PM, that time isn't available.
[2025-09-15T09:39:22.083Z] 🔍 ConversationText role: 'assistant' -> Speaker: 'AI'
📝 TRANSCRIPT: Added AI: For the haircut on Thursday, 18th September 2025 at 2 PM, that time isn't available.
📨 Received Deepgram JSON message: {"type":"History","role":"assistant","content":"For the haircut on Thursday, 18th September 2025 at 2 PM, that time isn't available."}...
Message string: {"type":"History","role":"assistant","content":"For the haircut on Thursday, 18th September 2025 at 2 PM, that time isn't available."}
[2025-09-15T09:39:22.084Z] 📨 JSON MESSAGE FROM DEEPGRAM: {"type":"History","role":"assistant","content":"For the haircut on Thursday, 18th September 2025 at 2 PM, that time isn't available."}
[2025-09-15T09:39:22.084Z] === PARSED DEEPGRAM JSON ===
{
  "type": "History",
  "role": "assistant",
  "content": "For the haircut on Thursday, 18th September 2025 at 2 PM, that time isn't available."
}
[2025-09-15T09:39:22.084Z] === END PARSED JSON ===
[2025-09-15T09:39:22.084Z] 🎯 DEEPGRAM EVENT TYPE: History
[2025-09-15T09:39:22.084Z] 📜 HISTORY: Message logged
[2025-09-15T09:39:22.084Z] 🔍 History role: 'assistant' -> Speaker: 'AI'
📝 TRANSCRIPT: Skipping duplicate AI: For the haircut on Thursday, 18th September 2025 at 2 PM, that time isn't available.
[2025-09-15T09:39:22.084Z] 📝 Added transcript: [AI] For the haircut on Thursday, 18th September 2025 at 2 PM, that time isn't available.
[2025-09-15T09:39:22.084Z] 🎵 Starting audio stream - feeding buffer
[2025-09-15T09:39:25.094Z] 🔇 Audio stream ended (timeout)
[2025-09-15T09:39:25.634Z] 💓 KEEPALIVE: Sent to Deepgram
📨 Received Deepgram JSON message: {"type":"ConversationText","role":"assistant","content":"But I have 2:30 PM or 2:45 PM available."}...
Message string: {"type":"ConversationText","role":"assistant","content":"But I have 2:30 PM or 2:45 PM available."}
[2025-09-15T09:39:29.326Z] 📨 JSON MESSAGE FROM DEEPGRAM: {"type":"ConversationText","role":"assistant","content":"But I have 2:30 PM or 2:45 PM available."}
[2025-09-15T09:39:29.326Z] === PARSED DEEPGRAM JSON ===
{
  "type": "ConversationText",
  "role": "assistant",
  "content": "But I have 2:30 PM or 2:45 PM available."
}
[2025-09-15T09:39:29.326Z] === END PARSED JSON ===
[2025-09-15T09:39:29.326Z] 🎯 DEEPGRAM EVENT TYPE: ConversationText
[2025-09-15T09:39:29.326Z] 💭 CONVERSATION_TEXT: But I have 2:30 PM or 2:45 PM available.
[2025-09-15T09:39:29.326Z] 🔍 ConversationText role: 'assistant' -> Speaker: 'AI'
📝 TRANSCRIPT: Added AI: But I have 2:30 PM or 2:45 PM available.
📨 Received Deepgram JSON message: {"type":"History","role":"assistant","content":"But I have 2:30 PM or 2:45 PM available."}...
Message string: {"type":"History","role":"assistant","content":"But I have 2:30 PM or 2:45 PM available."}
[2025-09-15T09:39:29.326Z] 📨 JSON MESSAGE FROM DEEPGRAM: {"type":"History","role":"assistant","content":"But I have 2:30 PM or 2:45 PM available."}
[2025-09-15T09:39:29.326Z] === PARSED DEEPGRAM JSON ===
{
  "type": "History",
  "role": "assistant",
  "content": "But I have 2:30 PM or 2:45 PM available."
}
[2025-09-15T09:39:29.326Z] === END PARSED JSON ===
[2025-09-15T09:39:29.326Z] 🎯 DEEPGRAM EVENT TYPE: History
[2025-09-15T09:39:29.326Z] 📜 HISTORY: Message logged
[2025-09-15T09:39:29.326Z] 🔍 History role: 'assistant' -> Speaker: 'AI'
📝 TRANSCRIPT: Skipping duplicate AI: But I have 2:30 PM or 2:45 PM available.
[2025-09-15T09:39:29.326Z] 📝 Added transcript: [AI] But I have 2:30 PM or 2:45 PM available.
[2025-09-15T09:39:29.326Z] 🎵 Starting audio stream - feeding buffer
[2025-09-15T09:39:29.633Z] 💓 KEEPALIVE: Sent to Deepgram
[2025-09-15T09:39:29.621Z] 🔇 Audio stream ended (timeout)
[2025-09-15T09:39:33.634Z] 💓 KEEPALIVE: Sent to Deepgram
📨 Received Deepgram JSON message: {"type":"ConversationText","role":"assistant","content":"Which one works better for you?"}...
Message string: {"type":"ConversationText","role":"assistant","content":"Which one works better for you?"}
[2025-09-15T09:39:34.848Z] 📨 JSON MESSAGE FROM DEEPGRAM: {"type":"ConversationText","role":"assistant","content":"Which one works better for you?"}
[2025-09-15T09:39:34.848Z] === PARSED DEEPGRAM JSON ===
{
  "type": "ConversationText",
  "role": "assistant",
  "content": "Which one works better for you?"
}
[2025-09-15T09:39:34.848Z] === END PARSED JSON ===
[2025-09-15T09:39:34.848Z] 🎯 DEEPGRAM EVENT TYPE: ConversationText
[2025-09-15T09:39:34.848Z] 💭 CONVERSATION_TEXT: Which one works better for you?
[2025-09-15T09:39:34.848Z] 🔍 ConversationText role: 'assistant' -> Speaker: 'AI'
📝 TRANSCRIPT: Added AI: Which one works better for you?
📨 Received Deepgram JSON message: {"type":"History","role":"assistant","content":"Which one works better for you?"}...
Message string: {"type":"History","role":"assistant","content":"Which one works better for you?"}
[2025-09-15T09:39:34.848Z] 📨 JSON MESSAGE FROM DEEPGRAM: {"type":"History","role":"assistant","content":"Which one works better for you?"}
[2025-09-15T09:39:34.848Z] === PARSED DEEPGRAM JSON ===
{
  "type": "History",
  "role": "assistant",
  "content": "Which one works better for you?"
}
[2025-09-15T09:39:34.848Z] === END PARSED JSON ===
[2025-09-15T09:39:34.848Z] 🎯 DEEPGRAM EVENT TYPE: History
[2025-09-15T09:39:34.848Z] 📜 HISTORY: Message logged
[2025-09-15T09:39:34.848Z] 🔍 History role: 'assistant' -> Speaker: 'AI'
📝 TRANSCRIPT: Skipping duplicate AI: Which one works better for you?
[2025-09-15T09:39:34.848Z] 📝 Added transcript: [AI] Which one works better for you?
[2025-09-15T09:39:34.848Z] 🎵 Starting audio stream - feeding buffer
📨 Received Deepgram JSON message: {"type":"AgentAudioDone"}...
Message string: {"type":"AgentAudioDone"}
[2025-09-15T09:39:34.996Z] 📨 JSON MESSAGE FROM DEEPGRAM: {"type":"AgentAudioDone"}
[2025-09-15T09:39:34.996Z] === PARSED DEEPGRAM JSON ===
{
  "type": "AgentAudioDone"
}
[2025-09-15T09:39:34.996Z] === END PARSED JSON ===
[2025-09-15T09:39:34.996Z] 🎯 DEEPGRAM EVENT TYPE: AgentAudioDone
[2025-09-15T09:39:34.996Z] 🔇 AGENT_AUDIO_DONE: AI finished sending audio
[2025-09-15T09:39:34.996Z] 🔇 SILENCE: Started tracking
[2025-09-15T09:39:34.996Z] ✅ Agent speech ended. Pacer will now send silence until next utterance.
[2025-09-15T09:39:34.996Z] 🔇 SILENCE_CHECK: 1000ms of silence
[2025-09-15T09:39:34.996Z] 🔇 SILENCE_CHECK: 2001ms of silence
[2025-09-15T09:39:37.634Z] 💓 KEEPALIVE: Sent to Deepgram
[2025-09-15T09:39:34.996Z] 🔇 SILENCE_CHECK: 3001ms of silence
[2025-09-15T09:39:34.996Z] 🔇 SILENCE_CHECK: 4001ms of silence
📨 Received Deepgram JSON message: {"type":"UserStartedSpeaking"}...
Message string: {"type":"UserStartedSpeaking"}
[2025-09-15T09:39:39.080Z] 📨 JSON MESSAGE FROM DEEPGRAM: {"type":"UserStartedSpeaking"}
[2025-09-15T09:39:39.080Z] === PARSED DEEPGRAM JSON ===
{
  "type": "UserStartedSpeaking"
}
[2025-09-15T09:39:39.080Z] === END PARSED JSON ===
[2025-09-15T09:39:39.080Z] 🎯 DEEPGRAM EVENT TYPE: UserStartedSpeaking
[2025-09-15T09:39:39.080Z] 🎤 USER_STARTED_SPEAKING: User began speaking
[2025-09-15T09:39:39.080Z] 🔄 BARGE_IN: Cleared Twilio audio queue for user speech
[2025-09-15T09:39:39.080Z] 🔄 SILENCE_RESET: User speaking, silence tracking reset
📨 Received Deepgram JSON message: {"type":"ConversationText","role":"user","content":"So two forty five PM."}...
Message string: {"type":"ConversationText","role":"user","content":"So two forty five PM."}
[2025-09-15T09:39:39.661Z] 📨 JSON MESSAGE FROM DEEPGRAM: {"type":"ConversationText","role":"user","content":"So two forty five PM."}
[2025-09-15T09:39:39.661Z] === PARSED DEEPGRAM JSON ===
{
  "type": "ConversationText",
  "role": "user",
  "content": "So two forty five PM."
}
[2025-09-15T09:39:39.661Z] === END PARSED JSON ===
[2025-09-15T09:39:39.661Z] 🎯 DEEPGRAM EVENT TYPE: ConversationText
[2025-09-15T09:39:39.661Z] 💭 CONVERSATION_TEXT: So two forty five PM.
[2025-09-15T09:39:39.661Z] 🔍 ConversationText role: 'user' -> Speaker: 'User'
📝 TRANSCRIPT: Added User: So two forty five PM.
📨 Received Deepgram JSON message: {"type":"History","role":"user","content":"So two forty five PM."}...
Message string: {"type":"History","role":"user","content":"So two forty five PM."}
[2025-09-15T09:39:39.668Z] 📨 JSON MESSAGE FROM DEEPGRAM: {"type":"History","role":"user","content":"So two forty five PM."}
[2025-09-15T09:39:39.668Z] === PARSED DEEPGRAM JSON ===
{
  "type": "History",
  "role": "user",
  "content": "So two forty five PM."
}
[2025-09-15T09:39:39.668Z] === END PARSED JSON ===
[2025-09-15T09:39:39.668Z] 🎯 DEEPGRAM EVENT TYPE: History
[2025-09-15T09:39:39.668Z] 📜 HISTORY: Message logged
[2025-09-15T09:39:39.668Z] 🔍 History role: 'user' -> Speaker: 'User'
📝 TRANSCRIPT: Skipping duplicate User: So two forty five PM.
[2025-09-15T09:39:39.668Z] 📝 Added transcript: [User] So two forty five PM.
📨 Received Deepgram JSON message: {"type":"FunctionCallRequest","functions":[{"id":"call_kzQwW8s8vSWvXPVjYwzVRyno","name":"create_booking","arguments":"{\"customer_name\":\"Marco\",\"date\":\"2025-09-18\",\"service_id\":\"4395775e-fa8...
Message string: {"type":"FunctionCallRequest","functions":[{"id":"call_kzQwW8s8vSWvXPVjYwzVRyno","name":"create_booking","arguments":"{\"customer_name\":\"Marco\",\"date\":\"2025-09-18\",\"service_id\":\"4395775e-fa81-4a69-8425-e46c3853dea4\",\"time\":\"14:45\"}","client_side":true}]}
[2025-09-15T09:39:40.604Z] 📨 JSON MESSAGE FROM DEEPGRAM: {"type":"FunctionCallRequest","functions":[{"id":"call_kzQwW8s8vSWvXPVjYwzVRyno","name":"create_booking","arguments":"{\"customer_name\":\"Marco\",\"date\":\"2025-09-18\",\"service_id\":\"4395775e-fa81-4a69-8425-e46c3853dea4\",\"time\":\"14:45\"}","client_side":true}]}
[2025-09-15T09:39:40.604Z] === PARSED DEEPGRAM JSON ===
{
  "type": "FunctionCallRequest",
  "functions": [
    {
      "id": "call_kzQwW8s8vSWvXPVjYwzVRyno",
      "name": "create_booking",
      "arguments": "{\"customer_name\":\"Marco\",\"date\":\"2025-09-18\",\"service_id\":\"4395775e-fa81-4a69-8425-e46c3853dea4\",\"time\":\"14:45\"}",
      "client_side": true
    }
  ]
}
[2025-09-15T09:39:40.604Z] === END PARSED JSON ===
[2025-09-15T09:39:40.604Z] 🎯 DEEPGRAM EVENT TYPE: FunctionCallRequest
[2025-09-15T09:39:40.604Z] 🚨🚨 FUNCTION_CALL_REQUEST DETECTED! 🚨🚨
[2025-09-15T09:39:40.604Z] ✅ SUCCESS: AI requesting function calls!
[2025-09-15T09:39:40.604Z] 📋 Functions: [
  {
    "id": "call_kzQwW8s8vSWvXPVjYwzVRyno",
    "name": "create_booking",
    "arguments": "{\"customer_name\":\"Marco\",\"date\":\"2025-09-18\",\"service_id\":\"4395775e-fa81-4a69-8425-e46c3853dea4\",\"time\":\"14:45\"}",
    "client_side": true
  }
]
[2025-09-15T09:39:40.604Z] ⏸️ SILENCE: Pausing timer - Processing function calls
[2025-09-15T09:39:40.605Z] ⏸️ KEEPALIVE: Paused for function processing
[2025-09-15T09:39:40.604Z] 🔧 Processing function: create_booking
[2025-09-15T09:39:40.604Z] 🔧 CALLING: handleFunctionCall for create_booking...
📝 Session updated for call CA20b2d8268ce7b7a3ef3351f331ad95a0: {
  callerPhone: '+447468306825',
  customerName: 'Marco',
  lastBookingDate: '2025-09-17',
  lastBookingTime: '14:00',
  lastServiceId: '63555ab0-f0ac-48c3-a2b2-766356aeb8f4',
  lastServiceName: 'beard trim',
  lastServiceDuration: 15,
  bookings: [
    {
      customerName: 'Marco',
      date: '2025-09-18',
      time: '12:30',
      serviceId: '63555ab0-f0ac-48c3-a2b2-766356aeb8f4',
      serviceName: 'beard trim',
      serviceDuration: 15,
      appointmentId: '7c6e3a32-ae3e-42c9-97db-89a86e0525c7',
      type: 'create'
    },
    {
      customerName: 'Marco',
      currentDate: '2025-09-18',
      currentTime: '12:30',
      newDate: '2025-09-17',
      newTime: '12:45',
      newServiceId: undefined,
      type: 'update',
      finalDate: '2025-09-17',
      finalTime: '12:45:00',
      appointmentId: 'ee2b24b5-eff8-463b-ac9e-bfcf8d803a5a',
      serviceName: 'beard trim'
    },
    {
      customerName: 'Marco',
      currentDate: '2025-09-17',
      currentTime: '12:45',
      newDate: undefined,
      newTime: '14:00',
      newServiceId: undefined,
      type: 'update'
    },
    {
      customerName: 'Marco',
      currentDate: '2025-09-17',
      currentTime: '14:00',
      newDate: '2025-09-17',
      newTime: '14:00',
      newServiceId: undefined,
      type: 'update',
      finalDate: '2025-09-17',
      finalTime: '14:00:00',
      appointmentId: 'adaf6700-7750-45e7-86cb-9e42707b4654',
      serviceName: 'haircut'
    },
    {
      customerName: 'Marco',
      currentDate: '2025-09-17',
      currentTime: '14:00',
      newDate: undefined,
      newTime: undefined,
      newServiceId: '63555ab0-f0ac-48c3-a2b2-766356aeb8f4',
      type: 'update',
      finalDate: '2025-09-17',
      finalTime: '14:00:00',
      appointmentId: '4ca68442-2f04-486e-998f-9e945845cc4b',
      serviceName: 'beard trim'
    }
  ],
  lastAppointmentId: '7c6e3a32-ae3e-42c9-97db-89a86e0525c7'
}
[2025-09-15T09:39:40.605Z] 🚀 STARTING handleFunctionCall
[2025-09-15T09:39:40.605Z] 🔧 Function call received: {
  "function_name": "create_booking",
  "function_call_id": "call_kzQwW8s8vSWvXPVjYwzVRyno",
  "parameters": {
    "customer_name": "Marco",
    "date": "2025-09-18",
    "service_id": "4395775e-fa81-4a69-8425-e46c3853dea4",
    "time": "14:45"
  }
}
[2025-09-15T09:39:40.605Z] 📋 Function name: create_booking
[2025-09-15T09:39:40.605Z] 📊 Parameters: {
  "customer_name": "Marco",
  "date": "2025-09-18",
  "service_id": "4395775e-fa81-4a69-8425-e46c3853dea4",
  "time": "14:45"
}
[2025-09-15T09:39:40.605Z] 🏢 Business config exists: true
[2025-09-15T09:39:40.605Z] 🌐 WebSocket state: 1
🔧 Function call received: {
  "function_name": "create_booking",
  "function_call_id": "call_kzQwW8s8vSWvXPVjYwzVRyno",
  "parameters": {
    "customer_name": "Marco",
    "date": "2025-09-18",
    "service_id": "4395775e-fa81-4a69-8425-e46c3853dea4",
    "time": "14:45"
  }
}
✅ TRACKING: Added function call ID call_kzQwW8s8vSWvXPVjYwzVRyno to processed set
🎯 createBooking called with params: {
  "customer_name": "Marco",
  "date": "2025-09-18",
  "service_id": "4395775e-fa81-4a69-8425-e46c3853dea4",
  "time": "14:45"
}
📋 Available services: [
  { id: '4395775e-fa81-4a69-8425-e46c3853dea4', name: 'haircut' },
  { id: '63555ab0-f0ac-48c3-a2b2-766356aeb8f4', name: 'beard trim' }
]
✅ Booking - Service found: haircut (ID: 4395775e-fa81-4a69-8425-e46c3853dea4 )
📝 Session updated for call CA20b2d8268ce7b7a3ef3351f331ad95a0: {
  callerPhone: '+447468306825',
  customerName: 'Marco',
  lastBookingDate: '2025-09-18',
  lastBookingTime: '14:45',
  lastServiceId: '4395775e-fa81-4a69-8425-e46c3853dea4',
  lastServiceName: 'haircut',
  lastServiceDuration: 30,
  bookings: [
    {
      customerName: 'Marco',
      date: '2025-09-18',
      time: '12:30',
      serviceId: '63555ab0-f0ac-48c3-a2b2-766356aeb8f4',
      serviceName: 'beard trim',
      serviceDuration: 15,
      appointmentId: '7c6e3a32-ae3e-42c9-97db-89a86e0525c7',
      type: 'create'
    },
    {
      customerName: 'Marco',
      currentDate: '2025-09-18',
      currentTime: '12:30',
      newDate: '2025-09-17',
      newTime: '12:45',
      newServiceId: undefined,
      type: 'update',
      finalDate: '2025-09-17',
      finalTime: '12:45:00',
      appointmentId: 'ee2b24b5-eff8-463b-ac9e-bfcf8d803a5a',
      serviceName: 'beard trim'
    },
    {
      customerName: 'Marco',
      currentDate: '2025-09-17',
      currentTime: '12:45',
      newDate: undefined,
      newTime: '14:00',
      newServiceId: undefined,
      type: 'update'
    },
    {
      customerName: 'Marco',
      currentDate: '2025-09-17',
      currentTime: '14:00',
      newDate: '2025-09-17',
      newTime: '14:00',
      newServiceId: undefined,
      type: 'update',
      finalDate: '2025-09-17',
      finalTime: '14:00:00',
      appointmentId: 'adaf6700-7750-45e7-86cb-9e42707b4654',
      serviceName: 'haircut'
    },
    {
      customerName: 'Marco',
      currentDate: '2025-09-17',
      currentTime: '14:00',
      newDate: undefined,
      newTime: undefined,
      newServiceId: '63555ab0-f0ac-48c3-a2b2-766356aeb8f4',
      type: 'update',
      finalDate: '2025-09-17',
      finalTime: '14:00:00',
      appointmentId: '4ca68442-2f04-486e-998f-9e945845cc4b',
      serviceName: 'beard trim'
    },
    {
      customerName: 'Marco',
      date: '2025-09-18',
      time: '14:45',
      serviceId: '4395775e-fa81-4a69-8425-e46c3853dea4',
      serviceName: 'haircut',
      serviceDuration: 30,
      appointmentId: null,
      type: 'create'
    }
  ],
  lastAppointmentId: '7c6e3a32-ae3e-42c9-97db-89a86e0525c7'
}
🕐 Creating appointment for 2025-09-18 at 14:45 in timezone: Europe/London
📅 Parsed date: 2025-09-18 (Thursday)
🕐 Appointment datetime (UK local): 14:45:00
🕐 Business timezone: Europe/London
🕐 Start time: 14:45:00
🕐 End time: 15:15:00
📅 Day of week: Thursday
🔍 Checking slot availability before booking...
📋 Availability check result: {
  "available": true,
  "businessId": "1bb3c552-053f-40c4-b3f2-bdb51af87b52",
  "serviceId": "4395775e-fa81-4a69-8425-e46c3853dea4",
  "appointmentDate": "2025-09-18",
  "startTime": "14:45:00",
  "endTime": "15:15:00",
  "message": "Slot is available"
}
✅ Slot is available - proceeding with booking
📞 Calling internal Next.js booking API...
🔗 API URL: https://www.vocalenda.com/api/internal/booking
📦 Booking data: {
  "businessId": "1bb3c552-053f-40c4-b3f2-bdb51af87b52",
  "serviceId": "4395775e-fa81-4a69-8425-e46c3853dea4",
  "appointmentDate": "2025-09-18",
  "startTime": "14:45:00",
  "endTime": "15:15:00",
  "customerName": "Marco",
  "customerPhone": "+447468306825",
  "customerEmail": null,
  "notes": "Voice booking - Customer: Marco - Phone: +447468306825"
}
📡 API Response status: 200 OK
📋 API Response body: {
  "success": true,
  "appointmentId": "99de44fe-c940-4b73-a60d-93c0d1ca6712",
  "calendarEventId": "9bs0hbp810kcle0n61vp2hbgl4"
}
✅ Appointment created successfully via API: 99de44fe-c940-4b73-a60d-93c0d1ca6712
📅 Calendar event ID: 9bs0hbp810kcle0n61vp2hbgl4
📞 Updating call log with customer name: Marco
Failed to update call customer: {
  code: 'PGRST204',
✅ Call log updated with customer name: CA20b2d8268ce7b7a3ef3351f331ad95a0
  details: null,
  hint: null,
  message: "Could not find the 'customer_name' column of 'call_logs' in the schema cache"
}
📝 Session updated for call CA20b2d8268ce7b7a3ef3351f331ad95a0: {
  callerPhone: '+447468306825',
  customerName: 'Marco',
  lastBookingDate: '2025-09-18',
  lastBookingTime: '14:45',
  lastServiceId: '4395775e-fa81-4a69-8425-e46c3853dea4',
  lastServiceName: 'haircut',
  lastServiceDuration: 30,
  bookings: [
    {
      customerName: 'Marco',
      date: '2025-09-18',
      time: '12:30',
      serviceId: '63555ab0-f0ac-48c3-a2b2-766356aeb8f4',
      serviceName: 'beard trim',
      serviceDuration: 15,
      appointmentId: '7c6e3a32-ae3e-42c9-97db-89a86e0525c7',
      type: 'create'
    },
    {
      customerName: 'Marco',
      currentDate: '2025-09-18',
      currentTime: '12:30',
      newDate: '2025-09-17',
      newTime: '12:45',
      newServiceId: undefined,
      type: 'update',
      finalDate: '2025-09-17',
      finalTime: '12:45:00',
      appointmentId: 'ee2b24b5-eff8-463b-ac9e-bfcf8d803a5a',
      serviceName: 'beard trim'
    },
    {
      customerName: 'Marco',
      currentDate: '2025-09-17',
      currentTime: '12:45',
      newDate: undefined,
      newTime: '14:00',
      newServiceId: undefined,
      type: 'update'
    },
    {
      customerName: 'Marco',
      currentDate: '2025-09-17',
      currentTime: '14:00',
      newDate: '2025-09-17',
      newTime: '14:00',
      newServiceId: undefined,
      type: 'update',
      finalDate: '2025-09-17',
      finalTime: '14:00:00',
      appointmentId: 'adaf6700-7750-45e7-86cb-9e42707b4654',
      serviceName: 'haircut'
    },
    {
      customerName: 'Marco',
      currentDate: '2025-09-17',
      currentTime: '14:00',
      newDate: undefined,
      newTime: undefined,
      newServiceId: '63555ab0-f0ac-48c3-a2b2-766356aeb8f4',
      type: 'update',
      finalDate: '2025-09-17',
      finalTime: '14:00:00',
      appointmentId: '4ca68442-2f04-486e-998f-9e945845cc4b',
      serviceName: 'beard trim'
    },
    {
      customerName: 'Marco',
      date: '2025-09-18',
      time: '14:45',
      serviceId: '4395775e-fa81-4a69-8425-e46c3853dea4',
      serviceName: 'haircut',
      serviceDuration: 30,
      appointmentId: '99de44fe-c940-4b73-a60d-93c0d1ca6712',
      type: 'create'
    }
  ],
  lastAppointmentId: '99de44fe-c940-4b73-a60d-93c0d1ca6712'
}
📋 Stored appointment ID in session: 99de44fe-c940-4b73-a60d-93c0d1ca6712
✅ Sending create_booking response to Deepgram
✅ Function response sent successfully to Deepgram
🔄 Waiting for Deepgram to process the response...
📨 Received Deepgram JSON message: {"type":"History","function_calls":[{"id":"call_kzQwW8s8vSWvXPVjYwzVRyno","name":"create_booking","client_side":true,"arguments":"{\"customer_name\":\"Marco\",\"date\":\"2025-09-18\",\"service_id\":\"...
Message string: {"type":"History","function_calls":[{"id":"call_kzQwW8s8vSWvXPVjYwzVRyno","name":"create_booking","client_side":true,"arguments":"{\"customer_name\":\"Marco\",\"date\":\"2025-09-18\",\"service_id\":\"4395775e-fa81-4a69-8425-e46c3853dea4\",\"time\":\"14:45\"}","response":"{\"success\":true,\"appointment_id\":\"99de44fe-c940-4b73-a60d-93c0d1ca6712\",\"calendar_event_id\":\"9bs0hbp810kcle0n61vp2hbgl4\",\"message\":\"✅ BOOKING CONFIRMED: Appointment successfully booked for Marco on 2025-09-18 at 14:45 for haircut. Your appointment is confirmed and secured. Event has been added to your Google Calendar.\"}"}]}
[2025-09-15T09:39:43.405Z] 📨 JSON MESSAGE FROM DEEPGRAM: {"type":"History","function_calls":[{"id":"call_kzQwW8s8vSWvXPVjYwzVRyno","name":"create_booking","client_side":true,"arguments":"{\"customer_name\":\"Marco\",\"date\":\"2025-09-18\",\"service_id\":\"4395775e-fa81-4a69-8425-e46c3853dea4\",\"time\":\"14:45\"}","response":"{\"success\":true,\"appointment_id\":\"99de44fe-c940-4b73-a60d-93c0d1ca6712\",\"calendar_event_id\":\"9bs0hbp810kcle0n61vp2hbgl4\",\"message\":\"✅ BOOKING CONFIRMED: Appointment successfully booked for Marco on 2025-09-18 at 14:45 for haircut. Your appointment is confirmed and secured. Event has been added to your Google Calendar.\"}"}]}
[2025-09-15T09:39:43.405Z] === PARSED DEEPGRAM JSON ===
{
  "type": "History",
  "function_calls": [
    {
      "id": "call_kzQwW8s8vSWvXPVjYwzVRyno",
      "name": "create_booking",
      "client_side": true,
      "arguments": "{\"customer_name\":\"Marco\",\"date\":\"2025-09-18\",\"service_id\":\"4395775e-fa81-4a69-8425-e46c3853dea4\",\"time\":\"14:45\"}",
      "response": "{\"success\":true,\"appointment_id\":\"99de44fe-c940-4b73-a60d-93c0d1ca6712\",\"calendar_event_id\":\"9bs0hbp810kcle0n61vp2hbgl4\",\"message\":\"✅ BOOKING CONFIRMED: Appointment successfully booked for Marco on 2025-09-18 at 14:45 for haircut. Your appointment is confirmed and secured. Event has been added to your Google Calendar.\"}"
    }
  ]
}
[2025-09-15T09:39:43.405Z] === END PARSED JSON ===
[2025-09-15T09:39:43.405Z] 🎯 DEEPGRAM EVENT TYPE: History
[2025-09-15T09:39:43.405Z] 📜 HISTORY: Message logged
[2025-09-15T09:39:40.604Z] ✅ COMPLETED: handleFunctionCall for create_booking
[2025-09-15T09:39:44.258Z] ▶️ KEEPALIVE: Resumed after function processing
[2025-09-15T09:39:40.604Z] ▶️ SILENCE: Resuming timer - Function processing completed
📨 Received Deepgram JSON message: {"type":"ConversationText","role":"assistant","content":"Your haircut appointment is confirmed for 2:45 PM on Thursday, 18th September 2025."}...
Message string: {"type":"ConversationText","role":"assistant","content":"Your haircut appointment is confirmed for 2:45 PM on Thursday, 18th September 2025."}
[2025-09-15T09:39:44.815Z] 📨 JSON MESSAGE FROM DEEPGRAM: {"type":"ConversationText","role":"assistant","content":"Your haircut appointment is confirmed for 2:45 PM on Thursday, 18th September 2025."}
[2025-09-15T09:39:44.815Z] === PARSED DEEPGRAM JSON ===
{
  "type": "ConversationText",
  "role": "assistant",
  "content": "Your haircut appointment is confirmed for 2:45 PM on Thursday, 18th September 2025."
}
[2025-09-15T09:39:44.815Z] === END PARSED JSON ===
[2025-09-15T09:39:44.815Z] 🎯 DEEPGRAM EVENT TYPE: ConversationText
[2025-09-15T09:39:44.815Z] 💭 CONVERSATION_TEXT: Your haircut appointment is confirmed for 2:45 PM on Thursday, 18th September 2025.
[2025-09-15T09:39:44.815Z] 🔍 ConversationText role: 'assistant' -> Speaker: 'AI'
📝 TRANSCRIPT: Added AI: Your haircut appointment is confirmed for 2:45 PM on Thursday, 18th September 2025.
📨 Received Deepgram JSON message: {"type":"History","role":"assistant","content":"Your haircut appointment is confirmed for 2:45 PM on Thursday, 18th September 2025."}...
Message string: {"type":"History","role":"assistant","content":"Your haircut appointment is confirmed for 2:45 PM on Thursday, 18th September 2025."}
[2025-09-15T09:39:44.816Z] 📨 JSON MESSAGE FROM DEEPGRAM: {"type":"History","role":"assistant","content":"Your haircut appointment is confirmed for 2:45 PM on Thursday, 18th September 2025."}
[2025-09-15T09:39:44.816Z] === PARSED DEEPGRAM JSON ===
{
  "type": "History",
  "role": "assistant",
  "content": "Your haircut appointment is confirmed for 2:45 PM on Thursday, 18th September 2025."
}
[2025-09-15T09:39:44.816Z] === END PARSED JSON ===
[2025-09-15T09:39:44.816Z] 🎯 DEEPGRAM EVENT TYPE: History
[2025-09-15T09:39:44.816Z] 📜 HISTORY: Message logged
[2025-09-15T09:39:44.816Z] 🔍 History role: 'assistant' -> Speaker: 'AI'
📝 TRANSCRIPT: Skipping duplicate AI: Your haircut appointment is confirmed for 2:45 PM on Thursday, 18th September 2025.
[2025-09-15T09:39:44.816Z] 📝 Added transcript: [AI] Your haircut appointment is confirmed for 2:45 PM on Thursday, 18th September 2025.
[2025-09-15T09:39:44.816Z] 🎵 Starting audio stream - feeding buffer
[2025-09-15T09:39:45.636Z] 💓 KEEPALIVE: Sent to Deepgram
[2025-09-15T09:39:47.859Z] 🔇 Audio stream ended (timeout)
[2025-09-15T09:39:49.637Z] 💓 KEEPALIVE: Sent to Deepgram
📨 Received Deepgram JSON message: {"type":"ConversationText","role":"assistant","content":"Is there anything else I can assist you with today?"}...
Message string: {"type":"ConversationText","role":"assistant","content":"Is there anything else I can assist you with today?"}
[2025-09-15T09:39:52.137Z] 📨 JSON MESSAGE FROM DEEPGRAM: {"type":"ConversationText","role":"assistant","content":"Is there anything else I can assist you with today?"}
[2025-09-15T09:39:52.137Z] === PARSED DEEPGRAM JSON ===
{
  "type": "ConversationText",
  "role": "assistant",
  "content": "Is there anything else I can assist you with today?"
}
[2025-09-15T09:39:52.137Z] === END PARSED JSON ===
[2025-09-15T09:39:52.137Z] 🎯 DEEPGRAM EVENT TYPE: ConversationText
[2025-09-15T09:39:52.137Z] 💭 CONVERSATION_TEXT: Is there anything else I can assist you with today?
[2025-09-15T09:39:52.137Z] 🔍 ConversationText role: 'assistant' -> Speaker: 'AI'
📝 TRANSCRIPT: Added AI: Is there anything else I can assist you with today?
📨 Received Deepgram JSON message: {"type":"History","role":"assistant","content":"Is there anything else I can assist you with today?"}...
Message string: {"type":"History","role":"assistant","content":"Is there anything else I can assist you with today?"}
[2025-09-15T09:39:52.138Z] 📨 JSON MESSAGE FROM DEEPGRAM: {"type":"History","role":"assistant","content":"Is there anything else I can assist you with today?"}
[2025-09-15T09:39:52.138Z] === PARSED DEEPGRAM JSON ===
{
  "type": "History",
  "role": "assistant",
  "content": "Is there anything else I can assist you with today?"
}
[2025-09-15T09:39:52.138Z] === END PARSED JSON ===
[2025-09-15T09:39:52.138Z] 🎯 DEEPGRAM EVENT TYPE: History
[2025-09-15T09:39:52.138Z] 📜 HISTORY: Message logged
[2025-09-15T09:39:52.138Z] 🔍 History role: 'assistant' -> Speaker: 'AI'
📝 TRANSCRIPT: Skipping duplicate AI: Is there anything else I can assist you with today?
[2025-09-15T09:39:52.138Z] 📝 Added transcript: [AI] Is there anything else I can assist you with today?
[2025-09-15T09:39:52.138Z] 🎵 Starting audio stream - feeding buffer
📨 Received Deepgram JSON message: {"type":"AgentAudioDone"}...
Message string: {"type":"AgentAudioDone"}
[2025-09-15T09:39:52.286Z] 📨 JSON MESSAGE FROM DEEPGRAM: {"type":"AgentAudioDone"}
[2025-09-15T09:39:52.286Z] === PARSED DEEPGRAM JSON ===
{
  "type": "AgentAudioDone"
}
[2025-09-15T09:39:52.286Z] === END PARSED JSON ===
[2025-09-15T09:39:52.286Z] 🎯 DEEPGRAM EVENT TYPE: AgentAudioDone
[2025-09-15T09:39:52.286Z] 🔇 AGENT_AUDIO_DONE: AI finished sending audio
[2025-09-15T09:39:52.286Z] 🔇 SILENCE: Started tracking
[2025-09-15T09:39:52.286Z] ✅ Agent speech ended. Pacer will now send silence until next utterance.
[2025-09-15T09:39:52.286Z] 🔇 SILENCE_CHECK: 1000ms of silence
[2025-09-15T09:39:53.636Z] 💓 KEEPALIVE: Sent to Deepgram
[2025-09-15T09:39:52.286Z] 🔇 SILENCE_CHECK: 2000ms of silence
[2025-09-15T09:39:52.286Z] 🔇 SILENCE_CHECK: 3000ms of silence
📨 Received Deepgram JSON message: {"type":"UserStartedSpeaking"}...
Message string: {"type":"UserStartedSpeaking"}
[2025-09-15T09:39:55.480Z] 📨 JSON MESSAGE FROM DEEPGRAM: {"type":"UserStartedSpeaking"}
[2025-09-15T09:39:55.480Z] === PARSED DEEPGRAM JSON ===
{
  "type": "UserStartedSpeaking"
}
[2025-09-15T09:39:55.480Z] === END PARSED JSON ===
[2025-09-15T09:39:55.480Z] 🎯 DEEPGRAM EVENT TYPE: UserStartedSpeaking
[2025-09-15T09:39:55.480Z] 🎤 USER_STARTED_SPEAKING: User began speaking
[2025-09-15T09:39:55.480Z] 🔄 BARGE_IN: Cleared Twilio audio queue for user speech
[2025-09-15T09:39:55.480Z] 🔄 SILENCE_RESET: User speaking, silence tracking reset
[2025-09-15T09:39:57.637Z] 💓 KEEPALIVE: Sent to Deepgram
📨 Received Deepgram JSON message: {"type":"ConversationText","role":"user","content":"Yeah. So can you tell me when my bookings are?"}...
Message string: {"type":"ConversationText","role":"user","content":"Yeah. So can you tell me when my bookings are?"}
[2025-09-15T09:39:58.382Z] 📨 JSON MESSAGE FROM DEEPGRAM: {"type":"ConversationText","role":"user","content":"Yeah. So can you tell me when my bookings are?"}
[2025-09-15T09:39:58.382Z] === PARSED DEEPGRAM JSON ===
{
  "type": "ConversationText",
  "role": "user",
  "content": "Yeah. So can you tell me when my bookings are?"
}
[2025-09-15T09:39:58.382Z] === END PARSED JSON ===
[2025-09-15T09:39:58.382Z] 🎯 DEEPGRAM EVENT TYPE: ConversationText
[2025-09-15T09:39:58.382Z] 💭 CONVERSATION_TEXT: Yeah. So can you tell me when my bookings are?
[2025-09-15T09:39:58.382Z] 🔍 ConversationText role: 'user' -> Speaker: 'User'
📝 TRANSCRIPT: Added User: Yeah. So can you tell me when my bookings are?
📨 Received Deepgram JSON message: {"type":"History","role":"user","content":"Yeah. So can you tell me when my bookings are?"}...
Message string: {"type":"History","role":"user","content":"Yeah. So can you tell me when my bookings are?"}
[2025-09-15T09:39:58.388Z] 📨 JSON MESSAGE FROM DEEPGRAM: {"type":"History","role":"user","content":"Yeah. So can you tell me when my bookings are?"}
[2025-09-15T09:39:58.388Z] === PARSED DEEPGRAM JSON ===
{
  "type": "History",
  "role": "user",
  "content": "Yeah. So can you tell me when my bookings are?"
}
[2025-09-15T09:39:58.388Z] === END PARSED JSON ===
[2025-09-15T09:39:58.388Z] 🎯 DEEPGRAM EVENT TYPE: History
[2025-09-15T09:39:58.388Z] 📜 HISTORY: Message logged
[2025-09-15T09:39:58.388Z] 🔍 History role: 'user' -> Speaker: 'User'
📝 TRANSCRIPT: Skipping duplicate User: Yeah. So can you tell me when my bookings are?
[2025-09-15T09:39:58.388Z] 📝 Added transcript: [User] Yeah. So can you tell me when my bookings are?
📨 Received Deepgram JSON message: {"type":"UserStartedSpeaking"}...
Message string: {"type":"UserStartedSpeaking"}
[2025-09-15T09:39:59.156Z] 📨 JSON MESSAGE FROM DEEPGRAM: {"type":"UserStartedSpeaking"}
[2025-09-15T09:39:59.156Z] === PARSED DEEPGRAM JSON ===
{
  "type": "UserStartedSpeaking"
}
[2025-09-15T09:39:59.156Z] === END PARSED JSON ===
[2025-09-15T09:39:59.156Z] 🎯 DEEPGRAM EVENT TYPE: UserStartedSpeaking
[2025-09-15T09:39:59.156Z] 🎤 USER_STARTED_SPEAKING: User began speaking
[2025-09-15T09:39:59.156Z] 🔄 BARGE_IN: Cleared Twilio audio queue for user speech
[2025-09-15T09:39:59.156Z] 🔄 SILENCE_RESET: User speaking, silence tracking reset
📨 Received Deepgram JSON message: {"type":"ConversationText","role":"user","content":"Both of them?"}...
Message string: {"type":"ConversationText","role":"user","content":"Both of them?"}
[2025-09-15T09:39:59.187Z] 📨 JSON MESSAGE FROM DEEPGRAM: {"type":"ConversationText","role":"user","content":"Both of them?"}
[2025-09-15T09:39:59.187Z] === PARSED DEEPGRAM JSON ===
{
  "type": "ConversationText",
  "role": "user",
  "content": "Both of them?"
}
[2025-09-15T09:39:59.187Z] === END PARSED JSON ===
[2025-09-15T09:39:59.187Z] 🎯 DEEPGRAM EVENT TYPE: ConversationText
[2025-09-15T09:39:59.187Z] 💭 CONVERSATION_TEXT: Both of them?
[2025-09-15T09:39:59.187Z] 🔍 ConversationText role: 'user' -> Speaker: 'User'
📝 TRANSCRIPT: Added User: Both of them?
📨 Received Deepgram JSON message: {"type":"History","role":"user","content":"Both of them?"}...
Message string: {"type":"History","role":"user","content":"Both of them?"}
[2025-09-15T09:39:59.188Z] 📨 JSON MESSAGE FROM DEEPGRAM: {"type":"History","role":"user","content":"Both of them?"}
[2025-09-15T09:39:59.188Z] === PARSED DEEPGRAM JSON ===
{
  "type": "History",
  "role": "user",
  "content": "Both of them?"
}
[2025-09-15T09:39:59.188Z] === END PARSED JSON ===
[2025-09-15T09:39:59.188Z] 🎯 DEEPGRAM EVENT TYPE: History
[2025-09-15T09:39:59.188Z] 📜 HISTORY: Message logged
[2025-09-15T09:39:59.188Z] 🔍 History role: 'user' -> Speaker: 'User'
📝 TRANSCRIPT: Skipping duplicate User: Both of them?
[2025-09-15T09:39:59.188Z] 📝 Added transcript: [User] Both of them?
📨 Received Deepgram JSON message: {"type":"UserStartedSpeaking"}...
Message string: {"type":"UserStartedSpeaking"}
[2025-09-15T09:39:59.976Z] 📨 JSON MESSAGE FROM DEEPGRAM: {"type":"UserStartedSpeaking"}
[2025-09-15T09:39:59.976Z] === PARSED DEEPGRAM JSON ===
{
  "type": "UserStartedSpeaking"
}
[2025-09-15T09:39:59.976Z] === END PARSED JSON ===
[2025-09-15T09:39:59.976Z] 🎯 DEEPGRAM EVENT TYPE: UserStartedSpeaking
[2025-09-15T09:39:59.976Z] 🎤 USER_STARTED_SPEAKING: User began speaking
[2025-09-15T09:39:59.976Z] 🔄 BARGE_IN: Cleared Twilio audio queue for user speech
[2025-09-15T09:39:59.976Z] 🔄 SILENCE_RESET: User speaking, silence tracking reset
📨 Received Deepgram JSON message: {"type":"ConversationText","role":"user","content":"What time and date?"}...
Message string: {"type":"ConversationText","role":"user","content":"What time and date?"}
[2025-09-15T09:40:00.287Z] 📨 JSON MESSAGE FROM DEEPGRAM: {"type":"ConversationText","role":"user","content":"What time and date?"}
[2025-09-15T09:40:00.287Z] === PARSED DEEPGRAM JSON ===
{
  "type": "ConversationText",
  "role": "user",
  "content": "What time and date?"
}
[2025-09-15T09:40:00.287Z] === END PARSED JSON ===
[2025-09-15T09:40:00.287Z] 🎯 DEEPGRAM EVENT TYPE: ConversationText
[2025-09-15T09:40:00.287Z] 💭 CONVERSATION_TEXT: What time and date?
[2025-09-15T09:40:00.287Z] 🔍 ConversationText role: 'user' -> Speaker: 'User'
📝 TRANSCRIPT: Added User: What time and date?
📨 Received Deepgram JSON message: {"type":"History","role":"user","content":"What time and date?"}...
Message string: {"type":"History","role":"user","content":"What time and date?"}
[2025-09-15T09:40:00.288Z] 📨 JSON MESSAGE FROM DEEPGRAM: {"type":"History","role":"user","content":"What time and date?"}
[2025-09-15T09:40:00.288Z] === PARSED DEEPGRAM JSON ===
{
  "type": "History",
  "role": "user",
  "content": "What time and date?"
}
[2025-09-15T09:40:00.288Z] === END PARSED JSON ===
[2025-09-15T09:40:00.288Z] 🎯 DEEPGRAM EVENT TYPE: History
[2025-09-15T09:40:00.288Z] 📜 HISTORY: Message logged
[2025-09-15T09:40:00.288Z] 🔍 History role: 'user' -> Speaker: 'User'
📝 TRANSCRIPT: Skipping duplicate User: What time and date?
[2025-09-15T09:40:00.288Z] 📝 Added transcript: [User] What time and date?
[2025-09-15T09:40:01.637Z] 💓 KEEPALIVE: Sent to Deepgram
📨 Received Deepgram JSON message: {"type":"ConversationText","role":"assistant","content":"You have two appointments booked:\n1."}...
Message string: {"type":"ConversationText","role":"assistant","content":"You have two appointments booked:\n1."}
[2025-09-15T09:40:01.867Z] 📨 JSON MESSAGE FROM DEEPGRAM: {"type":"ConversationText","role":"assistant","content":"You have two appointments booked:\n1."}
[2025-09-15T09:40:01.867Z] === PARSED DEEPGRAM JSON ===
{
  "type": "ConversationText",
  "role": "assistant",
  "content": "You have two appointments booked:\n1."
}
[2025-09-15T09:40:01.867Z] === END PARSED JSON ===
[2025-09-15T09:40:01.867Z] 🎯 DEEPGRAM EVENT TYPE: ConversationText
[2025-09-15T09:40:01.867Z] 💭 CONVERSATION_TEXT: You have two appointments booked:
1.
[2025-09-15T09:40:01.867Z] 🔍 ConversationText role: 'assistant' -> Speaker: 'AI'
📝 TRANSCRIPT: Added AI: You have two appointments booked:
1.
📨 Received Deepgram JSON message: {"type":"History","role":"assistant","content":"You have two appointments booked:\n1."}...
Message string: {"type":"History","role":"assistant","content":"You have two appointments booked:\n1."}
[2025-09-15T09:40:01.867Z] 📨 JSON MESSAGE FROM DEEPGRAM: {"type":"History","role":"assistant","content":"You have two appointments booked:\n1."}
[2025-09-15T09:40:01.867Z] === PARSED DEEPGRAM JSON ===
{
  "type": "History",
  "role": "assistant",
  "content": "You have two appointments booked:\n1."
}
[2025-09-15T09:40:01.867Z] === END PARSED JSON ===
[2025-09-15T09:40:01.867Z] 🎯 DEEPGRAM EVENT TYPE: History
[2025-09-15T09:40:01.867Z] 📜 HISTORY: Message logged
[2025-09-15T09:40:01.867Z] 🔍 History role: 'assistant' -> Speaker: 'AI'
📝 TRANSCRIPT: Skipping duplicate AI: You have two appointments booked:
1.
[2025-09-15T09:40:01.867Z] 📝 Added transcript: [AI] You have two appointments booked:
1.
[2025-09-15T09:40:01.868Z] 🎵 Starting audio stream - feeding buffer
[2025-09-15T09:40:02.950Z] 🔇 Audio stream ended (timeout)
📨 Received Deepgram JSON message: {"type":"ConversationText","role":"assistant","content":"Beard trim on Wednesday, 17th September 2025 at 2 PM."}...
Message string: {"type":"ConversationText","role":"assistant","content":"Beard trim on Wednesday, 17th September 2025 at 2 PM."}
[2025-09-15T09:40:04.790Z] 📨 JSON MESSAGE FROM DEEPGRAM: {"type":"ConversationText","role":"assistant","content":"Beard trim on Wednesday, 17th September 2025 at 2 PM."}
[2025-09-15T09:40:04.790Z] === PARSED DEEPGRAM JSON ===
{
  "type": "ConversationText",
  "role": "assistant",
  "content": "Beard trim on Wednesday, 17th September 2025 at 2 PM."
}
[2025-09-15T09:40:04.790Z] === END PARSED JSON ===
[2025-09-15T09:40:04.790Z] 🎯 DEEPGRAM EVENT TYPE: ConversationText
[2025-09-15T09:40:04.790Z] 💭 CONVERSATION_TEXT: Beard trim on Wednesday, 17th September 2025 at 2 PM.
[2025-09-15T09:40:04.790Z] 🔍 ConversationText role: 'assistant' -> Speaker: 'AI'
📝 TRANSCRIPT: Added AI: Beard trim on Wednesday, 17th September 2025 at 2 PM.
📨 Received Deepgram JSON message: {"type":"History","role":"assistant","content":"Beard trim on Wednesday, 17th September 2025 at 2 PM."}...
Message string: {"type":"History","role":"assistant","content":"Beard trim on Wednesday, 17th September 2025 at 2 PM."}
[2025-09-15T09:40:04.938Z] 📨 JSON MESSAGE FROM DEEPGRAM: {"type":"History","role":"assistant","content":"Beard trim on Wednesday, 17th September 2025 at 2 PM."}
[2025-09-15T09:40:04.938Z] === PARSED DEEPGRAM JSON ===
{
  "type": "History",
  "role": "assistant",
  "content": "Beard trim on Wednesday, 17th September 2025 at 2 PM."
}
[2025-09-15T09:40:04.938Z] === END PARSED JSON ===
[2025-09-15T09:40:04.938Z] 🎯 DEEPGRAM EVENT TYPE: History
[2025-09-15T09:40:04.938Z] 📜 HISTORY: Message logged
[2025-09-15T09:40:04.938Z] 🔍 History role: 'assistant' -> Speaker: 'AI'
📝 TRANSCRIPT: Skipping duplicate AI: Beard trim on Wednesday, 17th September 2025 at 2 PM.
[2025-09-15T09:40:04.938Z] 📝 Added transcript: [AI] Beard trim on Wednesday, 17th September 2025 at 2 PM.
[2025-09-15T09:40:04.938Z] 🎵 Starting audio stream - feeding buffer
     ==> Detected service running on port 8080
     ==> Docs on specifying a port: https://render.com/docs/web-services#port-binding
[2025-09-15T09:40:05.637Z] 💓 KEEPALIVE: Sent to Deepgram
[2025-09-15T09:40:05.838Z] 🔇 Audio stream ended (timeout)
[2025-09-15T09:40:09.637Z] 💓 KEEPALIVE: Sent to Deepgram
📨 Received Deepgram JSON message: {"type":"ConversationText","role":"assistant","content":"2."}...
Message string: {"type":"ConversationText","role":"assistant","content":"2."}
[2025-09-15T09:40:11.152Z] 📨 JSON MESSAGE FROM DEEPGRAM: {"type":"ConversationText","role":"assistant","content":"2."}
[2025-09-15T09:40:11.152Z] === PARSED DEEPGRAM JSON ===
{
  "type": "ConversationText",
  "role": "assistant",
  "content": "2."
}
[2025-09-15T09:40:11.152Z] === END PARSED JSON ===
[2025-09-15T09:40:11.152Z] 🎯 DEEPGRAM EVENT TYPE: ConversationText
[2025-09-15T09:40:11.152Z] 💭 CONVERSATION_TEXT: 2.
[2025-09-15T09:40:11.152Z] 🔍 ConversationText role: 'assistant' -> Speaker: 'AI'
📝 TRANSCRIPT: Added AI: 2.
📨 Received Deepgram JSON message: {"type":"History","role":"assistant","content":"2."}...
Message string: {"type":"History","role":"assistant","content":"2."}
[2025-09-15T09:40:11.152Z] 📨 JSON MESSAGE FROM DEEPGRAM: {"type":"History","role":"assistant","content":"2."}
[2025-09-15T09:40:11.152Z] === PARSED DEEPGRAM JSON ===
{
  "type": "History",
  "role": "assistant",
  "content": "2."
}
[2025-09-15T09:40:11.152Z] === END PARSED JSON ===
[2025-09-15T09:40:11.152Z] 🎯 DEEPGRAM EVENT TYPE: History
[2025-09-15T09:40:11.152Z] 📜 HISTORY: Message logged
[2025-09-15T09:40:11.152Z] 🔍 History role: 'assistant' -> Speaker: 'AI'
📝 TRANSCRIPT: Skipping duplicate AI: 2.
[2025-09-15T09:40:11.152Z] 📝 Added transcript: [AI] 2.
[2025-09-15T09:40:11.152Z] 🎵 Starting audio stream - feeding buffer
[2025-09-15T09:40:11.168Z] 🔇 Audio stream ended (timeout)
📨 Received Deepgram JSON message: {"type":"ConversationText","role":"assistant","content":"Haircut on Thursday, 18th September 2025 at 2:45 PM."}...
Message string: {"type":"ConversationText","role":"assistant","content":"Haircut on Thursday, 18th September 2025 at 2:45 PM."}
[2025-09-15T09:40:11.714Z] 📨 JSON MESSAGE FROM DEEPGRAM: {"type":"ConversationText","role":"assistant","content":"Haircut on Thursday, 18th September 2025 at 2:45 PM."}
[2025-09-15T09:40:11.714Z] === PARSED DEEPGRAM JSON ===
{
  "type": "ConversationText",
  "role": "assistant",
  "content": "Haircut on Thursday, 18th September 2025 at 2:45 PM."
}
[2025-09-15T09:40:11.714Z] === END PARSED JSON ===
[2025-09-15T09:40:11.714Z] 🎯 DEEPGRAM EVENT TYPE: ConversationText
[2025-09-15T09:40:11.714Z] 💭 CONVERSATION_TEXT: Haircut on Thursday, 18th September 2025 at 2:45 PM.
[2025-09-15T09:40:11.714Z] 🔍 ConversationText role: 'assistant' -> Speaker: 'AI'
📝 TRANSCRIPT: Added AI: Haircut on Thursday, 18th September 2025 at 2:45 PM.
📨 Received Deepgram JSON message: {"type":"History","role":"assistant","content":"Haircut on Thursday, 18th September 2025 at 2:45 PM."}...
Message string: {"type":"History","role":"assistant","content":"Haircut on Thursday, 18th September 2025 at 2:45 PM."}
[2025-09-15T09:40:11.714Z] 📨 JSON MESSAGE FROM DEEPGRAM: {"type":"History","role":"assistant","content":"Haircut on Thursday, 18th September 2025 at 2:45 PM."}
[2025-09-15T09:40:11.714Z] === PARSED DEEPGRAM JSON ===
{
  "type": "History",
  "role": "assistant",
  "content": "Haircut on Thursday, 18th September 2025 at 2:45 PM."
}
[2025-09-15T09:40:11.714Z] === END PARSED JSON ===
[2025-09-15T09:40:11.714Z] 🎯 DEEPGRAM EVENT TYPE: History
[2025-09-15T09:40:11.714Z] 📜 HISTORY: Message logged
[2025-09-15T09:40:11.714Z] 🔍 History role: 'assistant' -> Speaker: 'AI'
📝 TRANSCRIPT: Skipping duplicate AI: Haircut on Thursday, 18th September 2025 at 2:45 PM.
[2025-09-15T09:40:11.714Z] 📝 Added transcript: [AI] Haircut on Thursday, 18th September 2025 at 2:45 PM.
[2025-09-15T09:40:11.714Z] 🎵 Starting audio stream - feeding buffer
[2025-09-15T09:40:13.639Z] 💓 KEEPALIVE: Sent to Deepgram
[2025-09-15T09:40:13.722Z] 🔇 Audio stream ended (timeout)
📨 Received Deepgram JSON message: {"type":"ConversationText","role":"assistant","content":"Is there anything else you'd like to do with these bookings?"}...
Message string: {"type":"ConversationText","role":"assistant","content":"Is there anything else you'd like to do with these bookings?"}
[2025-09-15T09:40:17.316Z] 📨 JSON MESSAGE FROM DEEPGRAM: {"type":"ConversationText","role":"assistant","content":"Is there anything else you'd like to do with these bookings?"}
[2025-09-15T09:40:17.316Z] === PARSED DEEPGRAM JSON ===
{
  "type": "ConversationText",
  "role": "assistant",
  "content": "Is there anything else you'd like to do with these bookings?"
}
[2025-09-15T09:40:17.316Z] === END PARSED JSON ===
[2025-09-15T09:40:17.316Z] 🎯 DEEPGRAM EVENT TYPE: ConversationText
[2025-09-15T09:40:17.316Z] 💭 CONVERSATION_TEXT: Is there anything else you'd like to do with these bookings?
[2025-09-15T09:40:17.316Z] 🔍 ConversationText role: 'assistant' -> Speaker: 'AI'
📝 TRANSCRIPT: Added AI: Is there anything else you'd like to do with these bookings?
📨 Received Deepgram JSON message: {"type":"History","role":"assistant","content":"Is there anything else you'd like to do with these bookings?"}...
Message string: {"type":"History","role":"assistant","content":"Is there anything else you'd like to do with these bookings?"}
[2025-09-15T09:40:17.316Z] 📨 JSON MESSAGE FROM DEEPGRAM: {"type":"History","role":"assistant","content":"Is there anything else you'd like to do with these bookings?"}
[2025-09-15T09:40:17.316Z] === PARSED DEEPGRAM JSON ===
{
  "type": "History",
  "role": "assistant",
  "content": "Is there anything else you'd like to do with these bookings?"
}
[2025-09-15T09:40:17.316Z] === END PARSED JSON ===
[2025-09-15T09:40:17.316Z] 🎯 DEEPGRAM EVENT TYPE: History
[2025-09-15T09:40:17.316Z] 📜 HISTORY: Message logged
[2025-09-15T09:40:17.316Z] 🔍 History role: 'assistant' -> Speaker: 'AI'
📝 TRANSCRIPT: Skipping duplicate AI: Is there anything else you'd like to do with these bookings?
[2025-09-15T09:40:17.316Z] 📝 Added transcript: [AI] Is there anything else you'd like to do with these bookings?
[2025-09-15T09:40:17.317Z] 🎵 Starting audio stream - feeding buffer
📨 Received Deepgram JSON message: {"type":"AgentAudioDone"}...
Message string: {"type":"AgentAudioDone"}
[2025-09-15T09:40:17.464Z] 📨 JSON MESSAGE FROM DEEPGRAM: {"type":"AgentAudioDone"}
[2025-09-15T09:40:17.464Z] === PARSED DEEPGRAM JSON ===
{
  "type": "AgentAudioDone"
}
[2025-09-15T09:40:17.464Z] === END PARSED JSON ===
[2025-09-15T09:40:17.464Z] 🎯 DEEPGRAM EVENT TYPE: AgentAudioDone
[2025-09-15T09:40:17.464Z] 🔇 AGENT_AUDIO_DONE: AI finished sending audio
[2025-09-15T09:40:17.464Z] 🔇 SILENCE: Started tracking
[2025-09-15T09:40:17.464Z] ✅ Agent speech ended. Pacer will now send silence until next utterance.
[2025-09-15T09:40:17.639Z] 💓 KEEPALIVE: Sent to Deepgram
[2025-09-15T09:40:17.464Z] 🔇 SILENCE_CHECK: 999ms of silence
[2025-09-15T09:40:17.464Z] 🔇 SILENCE_CHECK: 2000ms of silence
[2025-09-15T09:40:17.464Z] 🔇 SILENCE_CHECK: 3001ms of silence
[2025-09-15T09:40:17.464Z] 🔇 SILENCE_CHECK: 4002ms of silence
[2025-09-15T09:40:21.639Z] 💓 KEEPALIVE: Sent to Deepgram
📨 Received Deepgram JSON message: {"type":"UserStartedSpeaking"}...
Message string: {"type":"UserStartedSpeaking"}
[2025-09-15T09:40:22.115Z] 📨 JSON MESSAGE FROM DEEPGRAM: {"type":"UserStartedSpeaking"}
[2025-09-15T09:40:22.115Z] === PARSED DEEPGRAM JSON ===
{
  "type": "UserStartedSpeaking"
}
[2025-09-15T09:40:22.115Z] === END PARSED JSON ===
[2025-09-15T09:40:22.115Z] 🎯 DEEPGRAM EVENT TYPE: UserStartedSpeaking
[2025-09-15T09:40:22.115Z] 🎤 USER_STARTED_SPEAKING: User began speaking
[2025-09-15T09:40:22.115Z] 🔄 BARGE_IN: Cleared Twilio audio queue for user speech
[2025-09-15T09:40:22.115Z] 🔄 SILENCE_RESET: User speaking, silence tracking reset
📨 Received Deepgram JSON message: {"type":"ConversationText","role":"user","content":"No. Bye."}...
Message string: {"type":"ConversationText","role":"user","content":"No. Bye."}
[2025-09-15T09:40:22.679Z] 📨 JSON MESSAGE FROM DEEPGRAM: {"type":"ConversationText","role":"user","content":"No. Bye."}
[2025-09-15T09:40:22.679Z] === PARSED DEEPGRAM JSON ===
{
  "type": "ConversationText",
  "role": "user",
  "content": "No. Bye."
}
[2025-09-15T09:40:22.679Z] === END PARSED JSON ===
[2025-09-15T09:40:22.679Z] 🎯 DEEPGRAM EVENT TYPE: ConversationText
[2025-09-15T09:40:22.679Z] 💭 CONVERSATION_TEXT: No. Bye.
[2025-09-15T09:40:22.679Z] 🔍 ConversationText role: 'user' -> Speaker: 'User'
📝 TRANSCRIPT: Added User: No. Bye.
📨 Received Deepgram JSON message: {"type":"History","role":"user","content":"No. Bye."}...
Message string: {"type":"History","role":"user","content":"No. Bye."}
[2025-09-15T09:40:22.688Z] 📨 JSON MESSAGE FROM DEEPGRAM: {"type":"History","role":"user","content":"No. Bye."}
[2025-09-15T09:40:22.688Z] === PARSED DEEPGRAM JSON ===
{
  "type": "History",
  "role": "user",
  "content": "No. Bye."
}
[2025-09-15T09:40:22.688Z] === END PARSED JSON ===
[2025-09-15T09:40:22.688Z] 🎯 DEEPGRAM EVENT TYPE: History
[2025-09-15T09:40:22.688Z] 📜 HISTORY: Message logged
[2025-09-15T09:40:22.688Z] 🔍 History role: 'user' -> Speaker: 'User'
📝 TRANSCRIPT: Skipping duplicate User: No. Bye.
[2025-09-15T09:40:22.688Z] 📝 Added transcript: [User] No. Bye.
📨 Received Deepgram JSON message: {"type":"FunctionCallRequest","functions":[{"id":"call_C2G4dr6K2zWSDFrayoZj0hAA","name":"end_call","arguments":"{\"reason\":\"customer said goodbye\"}","client_side":true}]}...
Message string: {"type":"FunctionCallRequest","functions":[{"id":"call_C2G4dr6K2zWSDFrayoZj0hAA","name":"end_call","arguments":"{\"reason\":\"customer said goodbye\"}","client_side":true}]}
[2025-09-15T09:40:24.075Z] 📨 JSON MESSAGE FROM DEEPGRAM: {"type":"FunctionCallRequest","functions":[{"id":"call_C2G4dr6K2zWSDFrayoZj0hAA","name":"end_call","arguments":"{\"reason\":\"customer said goodbye\"}","client_side":true}]}
[2025-09-15T09:40:24.075Z] === PARSED DEEPGRAM JSON ===
{
  "type": "FunctionCallRequest",
  "functions": [
    {
      "id": "call_C2G4dr6K2zWSDFrayoZj0hAA",
      "name": "end_call",
      "arguments": "{\"reason\":\"customer said goodbye\"}",
      "client_side": true
    }
  ]
}
[2025-09-15T09:40:24.075Z] === END PARSED JSON ===
[2025-09-15T09:40:24.075Z] 🎯 DEEPGRAM EVENT TYPE: FunctionCallRequest
[2025-09-15T09:40:24.075Z] 🚨🚨 FUNCTION_CALL_REQUEST DETECTED! 🚨🚨
[2025-09-15T09:40:24.075Z] ✅ SUCCESS: AI requesting function calls!
[2025-09-15T09:40:24.075Z] 📋 Functions: [
  {
    "id": "call_C2G4dr6K2zWSDFrayoZj0hAA",
    "name": "end_call",
    "arguments": "{\"reason\":\"customer said goodbye\"}",
    "client_side": true
  }
]
[2025-09-15T09:40:24.075Z] ⏸️ SILENCE: Pausing timer - Processing function calls
[2025-09-15T09:40:24.076Z] ⏸️ KEEPALIVE: Paused for function processing
[2025-09-15T09:40:24.075Z] 🔧 Processing function: end_call
[2025-09-15T09:40:24.075Z] 🔧 CALLING: handleFunctionCall for end_call...
📝 Session updated for call CA20b2d8268ce7b7a3ef3351f331ad95a0: {
  callerPhone: '+447468306825',
  customerName: 'Marco',
  lastBookingDate: '2025-09-18',
  lastBookingTime: '14:45',
  lastServiceId: '4395775e-fa81-4a69-8425-e46c3853dea4',
  lastServiceName: 'haircut',
  lastServiceDuration: 30,
  bookings: [
    {
      customerName: 'Marco',
      date: '2025-09-18',
      time: '12:30',
      serviceId: '63555ab0-f0ac-48c3-a2b2-766356aeb8f4',
      serviceName: 'beard trim',
      serviceDuration: 15,
      appointmentId: '7c6e3a32-ae3e-42c9-97db-89a86e0525c7',
      type: 'create'
    },
    {
      customerName: 'Marco',
      currentDate: '2025-09-18',
      currentTime: '12:30',
      newDate: '2025-09-17',
      newTime: '12:45',
      newServiceId: undefined,
      type: 'update',
      finalDate: '2025-09-17',
      finalTime: '12:45:00',
      appointmentId: 'ee2b24b5-eff8-463b-ac9e-bfcf8d803a5a',
      serviceName: 'beard trim'
    },
    {
      customerName: 'Marco',
      currentDate: '2025-09-17',
      currentTime: '12:45',
      newDate: undefined,
      newTime: '14:00',
      newServiceId: undefined,
      type: 'update'
    },
    {
      customerName: 'Marco',
      currentDate: '2025-09-17',
      currentTime: '14:00',
      newDate: '2025-09-17',
      newTime: '14:00',
      newServiceId: undefined,
      type: 'update',
      finalDate: '2025-09-17',
      finalTime: '14:00:00',
      appointmentId: 'adaf6700-7750-45e7-86cb-9e42707b4654',
      serviceName: 'haircut'
    },
    {
      customerName: 'Marco',
      currentDate: '2025-09-17',
      currentTime: '14:00',
      newDate: undefined,
      newTime: undefined,
      newServiceId: '63555ab0-f0ac-48c3-a2b2-766356aeb8f4',
      type: 'update',
      finalDate: '2025-09-17',
      finalTime: '14:00:00',
      appointmentId: '4ca68442-2f04-486e-998f-9e945845cc4b',
      serviceName: 'beard trim'
    },
    {
      customerName: 'Marco',
      date: '2025-09-18',
      time: '14:45',
      serviceId: '4395775e-fa81-4a69-8425-e46c3853dea4',
      serviceName: 'haircut',
      serviceDuration: 30,
      appointmentId: '99de44fe-c940-4b73-a60d-93c0d1ca6712',
      type: 'create'
    }
  ],
  lastAppointmentId: '99de44fe-c940-4b73-a60d-93c0d1ca6712'
}
[2025-09-15T09:40:24.076Z] 🚀 STARTING handleFunctionCall
[2025-09-15T09:40:24.076Z] 🔧 Function call received: {
  "function_name": "end_call",
  "function_call_id": "call_C2G4dr6K2zWSDFrayoZj0hAA",
  "parameters": {
    "reason": "customer said goodbye"
  }
}
[2025-09-15T09:40:24.076Z] 📋 Function name: end_call
[2025-09-15T09:40:24.076Z] 📊 Parameters: {
  "reason": "customer said goodbye"
}
[2025-09-15T09:40:24.076Z] 🏢 Business config exists: true
[2025-09-15T09:40:24.076Z] 🌐 WebSocket state: 1
🔧 Function call received: {
  "function_name": "end_call",
  "function_call_id": "call_C2G4dr6K2zWSDFrayoZj0hAA",
  "parameters": {
    "reason": "customer said goodbye"
  }
}
📞 endCall called with params: {
  "reason": "customer said goodbye"
}
📞 Call SID: CA20b2d8268ce7b7a3ef3351f331ad95a0
📋 Session data before ending call: {
  callerPhone: '+447468306825',
  customerName: 'Marco',
  lastBookingDate: '2025-09-18',
  lastBookingTime: '14:45',
  lastServiceId: '4395775e-fa81-4a69-8425-e46c3853dea4',
  lastServiceName: 'haircut',
  lastServiceDuration: 30,
  bookings: [
    {
      customerName: 'Marco',
      date: '2025-09-18',
      time: '12:30',
      serviceId: '63555ab0-f0ac-48c3-a2b2-766356aeb8f4',
      serviceName: 'beard trim',
      serviceDuration: 15,
      appointmentId: '7c6e3a32-ae3e-42c9-97db-89a86e0525c7',
      type: 'create'
    },
    {
      customerName: 'Marco',
      currentDate: '2025-09-18',
      currentTime: '12:30',
      newDate: '2025-09-17',
      newTime: '12:45',
      newServiceId: undefined,
      type: 'update',
      finalDate: '2025-09-17',
      finalTime: '12:45:00',
      appointmentId: 'ee2b24b5-eff8-463b-ac9e-bfcf8d803a5a',
      serviceName: 'beard trim'
    },
    {
      customerName: 'Marco',
      currentDate: '2025-09-17',
      currentTime: '12:45',
      newDate: undefined,
      newTime: '14:00',
      newServiceId: undefined,
      type: 'update'
    },
    {
      customerName: 'Marco',
      currentDate: '2025-09-17',
      currentTime: '14:00',
      newDate: '2025-09-17',
      newTime: '14:00',
      newServiceId: undefined,
      type: 'update',
      finalDate: '2025-09-17',
      finalTime: '14:00:00',
      appointmentId: 'adaf6700-7750-45e7-86cb-9e42707b4654',
      serviceName: 'haircut'
    },
    {
      customerName: 'Marco',
      currentDate: '2025-09-17',
      currentTime: '14:00',
      newDate: undefined,
      newTime: undefined,
      newServiceId: '63555ab0-f0ac-48c3-a2b2-766356aeb8f4',
      type: 'update',
      finalDate: '2025-09-17',
      finalTime: '14:00:00',
      appointmentId: '4ca68442-2f04-486e-998f-9e945845cc4b',
      serviceName: 'beard trim'
    },
    {
      customerName: 'Marco',
      date: '2025-09-18',
      time: '14:45',
      serviceId: '4395775e-fa81-4a69-8425-e46c3853dea4',
      serviceName: 'haircut',
      serviceDuration: 30,
      appointmentId: '99de44fe-c940-4b73-a60d-93c0d1ca6712',
      type: 'create'
    }
  ],
  lastAppointmentId: '99de44fe-c940-4b73-a60d-93c0d1ca6712'
}
📱 Sending consolidated SMS confirmation for bookings: [
  '7c6e3a32-ae3e-42c9-97db-89a86e0525c7',
  'ee2b24b5-eff8-463b-ac9e-bfcf8d803a5a',
  'adaf6700-7750-45e7-86cb-9e42707b4654',
  '4ca68442-2f04-486e-998f-9e945845cc4b',
  '99de44fe-c940-4b73-a60d-93c0d1ca6712'
]
✅ Consolidated SMS sent successfully
✅ Consolidated SMS confirmation sent successfully
📞 Attempting to end call with SID: CA20b2d8268ce7b7a3ef3351f331ad95a0
📝 Reason: customer said goodbye
📨 Received Deepgram JSON message: {"type":"ConversationText","role":"assistant","content":"Thank you for calling Gents Barbershop, have a great day!"}...
Message string: {"type":"ConversationText","role":"assistant","content":"Thank you for calling Gents Barbershop, have a great day!"}
[2025-09-15T09:40:26.441Z] 📨 JSON MESSAGE FROM DEEPGRAM: {"type":"ConversationText","role":"assistant","content":"Thank you for calling Gents Barbershop, have a great day!"}
[2025-09-15T09:40:26.441Z] === PARSED DEEPGRAM JSON ===