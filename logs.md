 USER_STARTED_SPEAKING: User began speaking
[2025-09-08T13:24:58.807Z] ğŸ”„ SILENCE_RESET: User speaking, silence tracking reset
[2025-09-08T13:24:59.190Z] ğŸ’“ KEEPALIVE: Sent to Deepgram
ğŸ“¨ Received Deepgram JSON message: {"type":"ConversationText","role":"user","content":"Actually, forget about it. Bye."}...
Message string: {"type":"ConversationText","role":"user","content":"Actually, forget about it. Bye."}
[2025-09-08T13:25:00.105Z] ğŸ“¨ JSON MESSAGE FROM DEEPGRAM: {"type":"ConversationText","role":"user","content":"Actually, forget about it. Bye."}
[2025-09-08T13:25:00.105Z] === PARSED DEEPGRAM JSON ===
{
  "type": "ConversationText",
  "role": "user",
  "content": "Actually, forget about it. Bye."
}
[2025-09-08T13:25:00.105Z] === END PARSED JSON ===
[2025-09-08T13:25:00.105Z] ğŸ¯ DEEPGRAM EVENT TYPE: ConversationText
[2025-09-08T13:25:00.105Z] ğŸ’­ CONVERSATION_TEXT: Actually, forget about it. Bye.
ğŸ“¨ Received Deepgram JSON message: {"type":"History","role":"user","content":"Actually, forget about it. Bye."}...
Message string: {"type":"History","role":"user","content":"Actually, forget about it. Bye."}
[2025-09-08T13:25:00.123Z] ğŸ“¨ JSON MESSAGE FROM DEEPGRAM: {"type":"History","role":"user","content":"Actually, forget about it. Bye."}
[2025-09-08T13:25:00.123Z] === PARSED DEEPGRAM JSON ===
{
  "type": "History",
  "role": "user",
  "content": "Actually, forget about it. Bye."
}
[2025-09-08T13:25:00.123Z] === END PARSED JSON ===
[2025-09-08T13:25:00.123Z] ğŸ¯ DEEPGRAM EVENT TYPE: History
[2025-09-08T13:25:00.123Z] â“ UNKNOWN_EVENT_TYPE: History
[2025-09-08T13:25:00.123Z] ğŸ“¦ Full message: {
  "type": "History",
  "role": "user",
  "content": "Actually, forget about it. Bye."
}
ğŸ“¨ Received Deepgram JSON message: {"type":"ConversationText","role":"assistant","content":"Thank you for calling Gents Barbershop, have a great day!"}...
Message string: {"type":"ConversationText","role":"assistant","content":"Thank you for calling Gents Barbershop, have a great day!"}
[2025-09-08T13:25:01.306Z] ğŸ“¨ JSON MESSAGE FROM DEEPGRAM: {"type":"ConversationText","role":"assistant","content":"Thank you for calling Gents Barbershop, have a great day!"}
[2025-09-08T13:25:01.306Z] === PARSED DEEPGRAM JSON ===
{
  "type": "ConversationText",
  "role": "assistant",
  "content": "Thank you for calling Gents Barbershop, have a great day!"
}
[2025-09-08T13:25:01.306Z] === END PARSED JSON ===
[2025-09-08T13:25:01.306Z] ğŸ¯ DEEPGRAM EVENT TYPE: ConversationText
[2025-09-08T13:25:01.306Z] ğŸ’­ CONVERSATION_TEXT: Thank you for calling Gents Barbershop, have a great day!
ğŸ“¨ Received Deepgram JSON message: {"type":"History","role":"assistant","content":"Thank you for calling Gents Barbershop, have a great day!"}...
Message string: {"type":"History","role":"assistant","content":"Thank you for calling Gents Barbershop, have a great day!"}
[2025-09-08T13:25:01.306Z] ğŸ“¨ JSON MESSAGE FROM DEEPGRAM: {"type":"History","role":"assistant","content":"Thank you for calling Gents Barbershop, have a great day!"}
[2025-09-08T13:25:01.306Z] === PARSED DEEPGRAM JSON ===
{
  "type": "History",
  "role": "assistant",
  "content": "Thank you for calling Gents Barbershop, have a great day!"
}
[2025-09-08T13:25:01.306Z] === END PARSED JSON ===
[2025-09-08T13:25:01.306Z] ğŸ¯ DEEPGRAM EVENT TYPE: History
[2025-09-08T13:25:01.306Z] â“ UNKNOWN_EVENT_TYPE: History
[2025-09-08T13:25:01.306Z] ğŸ“¦ Full message: {
  "type": "History",
  "role": "assistant",
  "content": "Thank you for calling Gents Barbershop, have a great day!"
}
[2025-09-08T13:25:01.306Z] ğŸµ Starting audio stream - feeding buffer
ğŸ“¨ Received Deepgram JSON message: {"type":"AgentAudioDone"}...
Message string: {"type":"AgentAudioDone"}
[2025-09-08T13:25:02.543Z] ğŸ“¨ JSON MESSAGE FROM DEEPGRAM: {"type":"AgentAudioDone"}
[2025-09-08T13:25:02.543Z] === PARSED DEEPGRAM JSON ===
{
  "type": "AgentAudioDone"
}
[2025-09-08T13:25:02.543Z] === END PARSED JSON ===
[2025-09-08T13:25:02.543Z] ğŸ¯ DEEPGRAM EVENT TYPE: AgentAudioDone
[2025-09-08T13:25:02.543Z] ğŸ”‡ AGENT_AUDIO_DONE: AI finished sending audio
[2025-09-08T13:25:02.543Z] â° SILENCE_START: Beginning silence tracking after AI speech
[2025-09-08T13:25:02.543Z] âœ… Agent speech ended. Pacer will now send silence until next utterance.
[2025-09-08T13:25:03.190Z] ğŸ’“ KEEPALIVE: Sent to Deepgram
[2025-09-08T13:25:02.543Z] ğŸ”‡ SILENCE_CHECK: 1000ms of silence
[2025-09-08T13:25:02.543Z] ğŸ”‡ SILENCE_CHECK: 2001ms of silence
[2025-09-08T13:25:02.543Z] ğŸ”‡ SILENCE_CHECK: 3002ms of silence
[2025-09-08T13:25:02.543Z] ğŸ”‡ SILENCE_CHECK: 4001ms of silence
[2025-09-08T13:25:07.190Z] ğŸ’“ KEEPALIVE: Sent to Deepgram
[2025-09-08T13:25:02.543Z] ğŸ”‡ SILENCE_CHECK: 5002ms of silence
[2025-09-08T13:25:02.543Z] ğŸ”‡ SILENCE_CHECK: 6003ms of silence
[2025-09-08T13:25:02.543Z] ğŸ”‡ SILENCE_CHECK: 7003ms of silence
ğŸ“¨ Received Deepgram JSON message: {"type":"UserStartedSpeaking"}...
Message string: {"type":"UserStartedSpeaking"}
[2025-09-08T13:25:09.696Z] ğŸ“¨ JSON MESSAGE FROM DEEPGRAM: {"type":"UserStartedSpeaking"}
[2025-09-08T13:25:09.696Z] === PARSED DEEPGRAM JSON ===
{
  "type": "UserStartedSpeaking"
}
[2025-09-08T13:25:09.696Z] === END PARSED JSON ===
[2025-09-08T13:25:09.696Z] ğŸ¯ DEEPGRAM EVENT TYPE: UserStartedSpeaking
[2025-09-08T13:25:09.696Z] ğŸ¤ USER_STARTED_SPEAKING: User began speaking
[2025-09-08T13:25:09.696Z] ğŸ”„ SILENCE_RESET: User speaking, silence tracking reset
ğŸ“¨ Received Deepgram JSON message: {"type":"ConversationText","role":"user","content":"End call."}...
Message string: {"type":"ConversationText","role":"user","content":"End call."}
[2025-09-08T13:25:10.402Z] ğŸ“¨ JSON MESSAGE FROM DEEPGRAM: {"type":"ConversationText","role":"user","content":"End call."}
[2025-09-08T13:25:10.402Z] === PARSED DEEPGRAM JSON ===
{
  "type": "ConversationText",
  "role": "user",
  "content": "End call."
}
[2025-09-08T13:25:10.402Z] === END PARSED JSON ===
[2025-09-08T13:25:10.402Z] ğŸ¯ DEEPGRAM EVENT TYPE: ConversationText
[2025-09-08T13:25:10.402Z] ğŸ’­ CONVERSATION_TEXT: End call.
ğŸ“¨ Received Deepgram JSON message: {"type":"History","role":"user","content":"End call."}...
Message string: {"type":"History","role":"user","content":"End call."}
[2025-09-08T13:25:10.403Z] ğŸ“¨ JSON MESSAGE FROM DEEPGRAM: {"type":"History","role":"user","content":"End call."}
[2025-09-08T13:25:10.403Z] === PARSED DEEPGRAM JSON ===
{
  "type": "History",
  "role": "user",
  "content": "End call."
}
[2025-09-08T13:25:10.403Z] === END PARSED JSON ===
[2025-09-08T13:25:10.403Z] ğŸ¯ DEEPGRAM EVENT TYPE: History
[2025-09-08T13:25:10.403Z] â“ UNKNOWN_EVENT_TYPE: History
[2025-09-08T13:25:10.403Z] ğŸ“¦ Full message: {
  "type": "History",
  "role": "user",
  "content": "End call."
}
[2025-09-08T13:25:11.190Z] ğŸ’“ KEEPALIVE: Sent to Deepgram
ğŸ“¨ Received Deepgram JSON message: {"type":"FunctionCallRequest","functions":[{"id":"call_n3Tb4ye92HfkHsNmhHJzHe6i","name":"end_call","arguments":"{\"reason\":\"customer said goodbye\"}","client_side":true}]}...
Message string: {"type":"FunctionCallRequest","functions":[{"id":"call_n3Tb4ye92HfkHsNmhHJzHe6i","name":"end_call","arguments":"{\"reason\":\"customer said goodbye\"}","client_side":true}]}
[2025-09-08T13:25:11.311Z] ğŸ“¨ JSON MESSAGE FROM DEEPGRAM: {"type":"FunctionCallRequest","functions":[{"id":"call_n3Tb4ye92HfkHsNmhHJzHe6i","name":"end_call","arguments":"{\"reason\":\"customer said goodbye\"}","client_side":true}]}
[2025-09-08T13:25:11.311Z] === PARSED DEEPGRAM JSON ===
{
  "type": "FunctionCallRequest",
  "functions": [
    {
      "id": "call_n3Tb4ye92HfkHsNmhHJzHe6i",
      "name": "end_call",
      "arguments": "{\"reason\":\"customer said goodbye\"}",
      "client_side": true
    }
  ]
}
[2025-09-08T13:25:11.311Z] === END PARSED JSON ===
[2025-09-08T13:25:11.311Z] ğŸ¯ DEEPGRAM EVENT TYPE: FunctionCallRequest
[2025-09-08T13:25:11.311Z] ğŸš¨ğŸš¨ FUNCTION_CALL_REQUEST DETECTED! ğŸš¨ğŸš¨
[2025-09-08T13:25:11.311Z] âœ… SUCCESS: AI requesting function calls!
[2025-09-08T13:25:11.311Z] ğŸ“‹ Functions: [
  {
    "id": "call_n3Tb4ye92HfkHsNmhHJzHe6i",
    "name": "end_call",
    "arguments": "{\"reason\":\"customer said goodbye\"}",
    "client_side": true
  }
]
[2025-09-08T13:25:11.311Z] â¸ï¸ KEEPALIVE: Paused for function processing
[2025-09-08T13:25:11.311Z] ğŸ”§ Processing function: end_call
[2025-09-08T13:25:11.311Z] ğŸ”§ CALLING: handleFunctionCall for end_call...
ğŸ“ Session updated for call CA9ecc116f8732b94ec38513fd0d5f6b14: { callerPhone: '+447468306825' }
[2025-09-08T13:25:11.312Z] ğŸš€ STARTING handleFunctionCall
[2025-09-08T13:25:11.312Z] ğŸ”§ Function call received: {
  "function_name": "end_call",
  "function_call_id": "call_n3Tb4ye92HfkHsNmhHJzHe6i",
  "parameters": {
    "reason": "customer said goodbye"
  }
}
[2025-09-08T13:25:11.312Z] ğŸ“‹ Function name: end_call
[2025-09-08T13:25:11.312Z] ğŸ“Š Parameters: {
  "reason": "customer said goodbye"
}
[2025-09-08T13:25:11.312Z] ğŸ¢ Business config exists: true
[2025-09-08T13:25:11.312Z] ğŸŒ WebSocket state: 1
ğŸ”§ Function call received: {
  "function_name": "end_call",
  "function_call_id": "call_n3Tb4ye92HfkHsNmhHJzHe6i",
  "parameters": {
    "reason": "customer said goodbye"
  }
}
ğŸ“ endCall called with params: {
  "reason": "customer said goodbye"
}
ğŸ“ Call SID: CA9ecc116f8732b94ec38513fd0d5f6b14
ğŸ“ Attempting to end call with SID: CA9ecc116f8732b94ec38513fd0d5f6b14
ğŸ“ Reason: customer said goodbye
âœ… Call ended successfully: completed
ğŸ—‘ï¸ Session cleared for call CA9ecc116f8732b94ec38513fd0d5f6b14
âœ… Sending end_call response to Deepgram
âœ… Function response sent successfully to Deepgram
ğŸ”„ Waiting for Deepgram to process the response...
Media stream stopped
ğŸ“ Logging call completion: CA9ecc116f8732b94ec38513fd0d5f6b14
ğŸ“¨ Received Deepgram JSON message: {"type":"History","function_calls":[{"id":"call_n3Tb4ye92HfkHsNmhHJzHe6i","name":"end_call","client_side":true,"arguments":"{\"reason\":\"customer said goodbye\"}","response":"{\"success\":true,\"mess...
Message string: {"type":"History","function_calls":[{"id":"call_n3Tb4ye92HfkHsNmhHJzHe6i","name":"end_call","client_side":true,"arguments":"{\"reason\":\"customer said goodbye\"}","response":"{\"success\":true,\"message\":\"Call ended: customer said goodbye\",\"callSid\":\"CA9ecc116f8732b94ec38513fd0d5f6b14\",\"status\":\"completed\"}"}]}
[2025-09-08T13:25:11.908Z] ğŸ“¨ JSON MESSAGE FROM DEEPGRAM: {"type":"History","function_calls":[{"id":"call_n3Tb4ye92HfkHsNmhHJzHe6i","name":"end_call","client_side":true,"arguments":"{\"reason\":\"customer said goodbye\"}","response":"{\"success\":true,\"message\":\"Call ended: customer said goodbye\",\"callSid\":\"CA9ecc116f8732b94ec38513fd0d5f6b14\",\"status\":\"completed\"}"}]}
[2025-09-08T13:25:11.908Z] === PARSED DEEPGRAM JSON ===
{
  "type": "History",
  "function_calls": [
    {
      "id": "call_n3Tb4ye92HfkHsNmhHJzHe6i",
      "name": "end_call",
      "client_side": true,
      "arguments": "{\"reason\":\"customer said goodbye\"}",
      "response": "{\"success\":true,\"message\":\"Call ended: customer said goodbye\",\"callSid\":\"CA9ecc116f8732b94ec38513fd0d5f6b14\",\"status\":\"completed\"}"
    }
  ]
}
[2025-09-08T13:25:11.908Z] === END PARSED JSON ===
[2025-09-08T13:25:11.908Z] ğŸ¯ DEEPGRAM EVENT TYPE: History
[2025-09-08T13:25:11.908Z] â“ UNKNOWN_EVENT_TYPE: History
[2025-09-08T13:25:11.908Z] ğŸ“¦ Full message: {
  "type": "History",
  "function_calls": [
    {
      "id": "call_n3Tb4ye92HfkHsNmhHJzHe6i",
      "name": "end_call",
      "client_side": true,
      "arguments": "{\"reason\":\"customer said goodbye\"}",
      "response": "{\"success\":true,\"message\":\"Call ended: customer said goodbye\",\"callSid\":\"CA9ecc116f8732b94ec38513fd0d5f6b14\",\"status\":\"completed\"}"
    }
  ]
}
âœ… Call completion logged: CA9ecc116f8732b94ec38513fd0d5f6b14
ğŸ”Œ Closing Deepgram connection and cleaning up resources
ğŸ”‡ Persistent pacer cleaned up
ğŸ”‡ Silence tracking cleaned up
âœ… Deepgram connection closed successfully
Deepgram WebSocket closed in initializeDeepgram. Code: 1000, Reason: Call ended
Deepgram WebSocket closed. Code: 1000, Reason: Call ended
[2025-09-08T13:25:11.311Z] âœ… COMPLETED: handleFunctionCall for end_call
[2025-09-08T13:25:12.759Z] â–¶ï¸ KEEPALIVE: Resumed after function processing
Twilio WebSocket connection closed
ğŸ“ Logging call completion on close: CA9ecc116f8732b94ec38513fd0d5f6b14
âœ… Call completion logged on close: CA9ecc116f8732b94ec38513fd0d5f6b14
ğŸ”Œ Closing Deepgram connection and cleaning up resources
ğŸ”‡ Silence tracking cleaned up
â„¹ï¸ Deepgram connection already closed or not open